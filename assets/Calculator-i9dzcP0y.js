var pt=Object.defineProperty;var ht=(a,r,n)=>r in a?pt(a,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[r]=n;var P=(a,r,n)=>(ht(a,typeof r!="symbol"?r+"":r,n),n);import{m as lt,A as gt,az as q,aA as yt,d as mt,g as Ct,l as F,a as B,O as N,r as vt,o as L,b as R,e as k,h as K,f as p,t as M,u as S,H as _t,F as j,D as G,w,C as U,B as bt,aB as St,K as W,S as X,M as Q,aC as Et,G as At,p as It,i as Ot,_ as Tt}from"./index-pURzbvnK.js";import{C as wt}from"./TheConfirm-zHqI0j8X.js";import{o as H,i as tt,k as Dt,v as Lt}from"./Data-xUNdNJ6b.js";import{s as V}from"./globals-zpsYnYkF.js";function Rt(a,r){const n=lt({actually:{},plan:{},total:{intermediate:{},result:{}}}),e={};for(const u of a)n.total.result[u]=0;const C=r(e,n);return{provideGetterElements:m,output:n,update:O};function m(u){return u(D,e)}function O(u,l){const o=(i,v)=>b(i,([y],_,E)=>x(Object.fromEntries(E),y,u.actually[i],v)),c=(i,v)=>b(i,([,y])=>Array.isArray(y)?y[v-1]:y);l?(h(n.plan,l,o(l,u.plan[l])),h(n.actually,l,c(l,u.actually[l]))):(d(u.plan,n.plan,o),d(u.actually,n.actually,c)),T(n.total);for(const[i,v]of Object.entries(n.plan))if(Object.keys(v).length){for(const y of a)n.total.result[y]+=v[y];C(i,u)}}function b(u,l){return(...o)=>{const[[c]]=o;if(J(e[u][c])){const v=H(e[u][c],{map:(...y)=>[y[0][0],l(...y)]});return[c,v]}const i=l(...o);return[c,i]}}function h(u,l,o){e[l]&&(u[l]=H(e[l],{map:o}))}function d(u,l,o){if(Object.keys(u).length)for(const[c,i]of Object.entries(u))i?h(l,c,o(c,i)):l[c]={};else for(const c of Object.keys(l))delete l[c]}function x(u,l,o,c){const i=u[l],v=o>0?i[o-1]:0;let y=i[c-1];if(!Array.isArray(i))return!o&&c?i:0;if(a.includes(l)){y=0;let _=o>0?o-1:0;for(;_<=c-1;)y+=i[_],_++}return y-v}function T(u){for(const l in u)if(l in u){if(J(u[l])){T(u[l]);continue}u[l]=0}}function D(u,l){const o=Mt(u);return c(o),o;function c(i){for(const v in i)if(v in i){const y=i[v],_=typeof y[1]=="boolean"?y[0]:y;if(J(_)){const E=D(_,l);Object.keys(E).length?i[v]=E:delete i[v];continue}else if(!(Array.isArray(_)&&_.length==l)&&!a.includes(v)){delete i[v];continue}typeof y[1]=="boolean"&&(i[v]=_)}return i}}}function J(a){return typeof a=="object"&&!Array.isArray(a)&&a!==null}function Mt(a){const r=H(a,{map:([n,e])=>[n,[e,tt(n,a.Name)]],filter:([n,[,e]])=>n.startsWith("_")||tt(n,null,{asMeta:!0,asTitle:!1})?!1:gt.state.userSettings.disableFilters?!0:!e});if(a.projectile){const{projectile:n}=r;delete r.projectile,r.projectile=n}return r}const et={crush:(a,r=50)=>{const n="",e=(h,d)=>{let x=d.length,T="";const D=o=>encodeURI(encodeURIComponent(o)).replace(/%../g,"i").length,u=o=>{let c=o.charCodeAt(0),i=o.charCodeAt(o.length-1);return c>=56320&&c<=57343||i>=55296&&i<=56319};let l={};for(let o=2;o<r;o++)for(let c=0;c<h.length-o;++c){let i=h.substr(c,o);if(l[i]||u(i))continue;let v=1;for(let y=h.indexOf(i,c+o);y>=0;++v)y=h.indexOf(i,y+o);v>1&&(l[i]=v)}for(;;){for(;x--&&h.includes(d[x]););if(x<0)break;let o=d[x],c,i=0,v=D(o);for(let _ in l){let E=l[_],I=(E-1)*D(_)-(E+1)*v;T.length||(I-=D(n)),I<=0?delete l[_]:I>i&&(c=_,i=I)}if(!c)break;h=h.split(c).join(o)+o+c,T=o+T;let y={};for(let _ in l){let E=_.split(c).join(o),I=0;for(let $=h.indexOf(E);$>=0;++I)$=h.indexOf(E,$+E.length);I>1&&(y[E]=I)}l=y}return{a:h,b:T}};let C=[];const m="-_.!~*'()";for(let h=127;--h;)(h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||m.includes(String.fromCharCode(h)))&&C.push(String.fromCharCode(h));for(let h=32;h<255;++h){let d=String.fromCharCode(h);d!="\\"&&!C.includes(d)&&C.unshift(d)}a=a.replace(new RegExp(n,"g"),""),a=nt(a);const O=e(a,C);let b=O.a;return O.b.length&&(b+=n+O.b),b+="_",b},uncrush:a=>{a=a.substring(0,a.length-1);const r=a.split("");let n=r[0];if(r.length>1){let e=r[1];for(let C of e){let m=n.split(C);n=m.join(m.pop())}}return nt(n,0)}},nt=(a,r=1)=>{const n=[['"',"'"],["':","!"],[",'","~"],["}",")","\\","\\"],["{","(","\\","\\"]],e=(C,m)=>{let O=new RegExp(`${(m[2]?m[2]:"")+m[0]}|${(m[3]?m[3]:"")+m[1]}`,"g");return C.replace(O,b=>b===m[0]?m[1]:m[0])};if(r)for(let C=0;C<n.length;++C)a=e(a,n[C]);else for(let C=n.length;C--;)a=e(a,n[C]);return a},st="new entry",z="en";class xt{constructor(r){P(this,"store");P(this,"TIDs",{});this.localStoreKey=r,this.store=lt({configs:[],selected:0}),this.load()}get selectedConfig(){return this.store.configs[this.store.selected].value}load(){const r=JSON.parse(localStorage.getItem(this.localStoreKey)||"{}");if(r.configs){Object.assign(this.store,r);return}if(Object.keys(r).length&&r.actually&&r.plan){this.add(r);return}this.add()}save(){localStorage.setItem(this.localStoreKey,JSON.stringify(this.store))}removeSelected(){if(this.store.configs.splice(this.store.selected,1),this.store.configs.length==0){this.add();return}this.store.selected=this.store.configs.length-1}add(r,{temporary:n}={temporary:!1}){const e=this.store;let C=0,m;do m=C?`${st} #${C}`:st,C++;while(e.configs.length&&e.configs.some(O=>O.name==m));e.configs=[...e.configs,{name:m,value:r||{actually:{},plan:{}}}],e.selected=e.configs.length-1,n||this.save()}async parseString(r){const n=[];q.global.availableLocales.includes(z)||await yt(z);for(const[e,C]of Object.entries(this.TIDs)){const m=q.global.t(C,z),O=new RegExp(`${m}\\s+?(\\d+)\\s?`,"mi"),[,b]=r.match(O)||[void 0,"0"];n.push([e,parseInt(b)])}return Object.fromEntries(n.filter(([,e])=>e))}stringifyUrl(){const r=JSON.stringify(this.selectedConfig.actually);return et.crush(r)}parseUrl(r){return JSON.parse(et.uncrush(r))}}const $t=a=>(It("data-v-1a125565"),a=a(),Ot(),a),Ut={class:"topic"},Ft={class:"total-table"},Nt={key:0,colspan:"3"},kt={class:"buttons"},jt={class:"reset-buttons"},Gt={class:"settings-modal"},Pt={class:"input-wrap"},Bt=["value"],Kt={class:"config-category"},Vt={class:"flex-end"},Jt={class:"select"},zt={class:"name"},Ht=["value"],Yt={class:"input"},Zt={class:"name"},qt=["placeholder"],Wt={class:"flex-end margin-bottom"},Xt={class:"input"},Qt={class:"name"},te=$t(()=>p("p",{class:"name"},"Example: Fortify 8 Bond 5",-1)),ee={class:"flex-end margin-bottom"},ne=mt({__name:"Calculator",props:{stackChars:{},calcTotal:{},localStorageKey:{},titleKey:{},input:{}},emits:["update:input","setup"],setup(a,{emit:r}){const{t:n}=Ct(),e=a,C=r,m={key:s=>Dt(s,N.currentRoute.value.name),value:(s,t)=>Lt(s,t,N.currentRoute.value.name)},{provideGetterElements:O,output:b,update:h}=Rt(e.stackChars,e.calcTotal),d=new xt(e.localStorageKey),x={output:b,onChangeLvl:Y,isSelected:ct,isDisabled:ut,outputClasses:ft,forceReCalc:I,format:m,provideGetterElements:s=>O((...t)=>s(d.TIDs,...t))};let T=()=>Promise.prototype;const D=F(!1),u=F(!1),l=F(""),o=F({text:n("COPY"),color:"yellow"}),c=B(()=>n(e.titleKey)),i=B(()=>Object.keys(b.total.result)),v=B(()=>`${location.origin}${location.pathname}`);if(N.currentRoute.value.query.d){const s=d.parseUrl(N.currentRoute.value.query.d),t={actually:{...s},plan:{...s}};d.add(t,{temporary:!0})}I(),C("setup",x);function y(s){T=s}function _(){C("update:input",d.selectedConfig)}function E(s){Et(()=>h(e.input,s))}function I(){_(),E()}async function $(s){if(s.target.name=="all")await T("Reset all ? Are you serious ?").then(()=>{for(const t in e.input)t in e.input&&(d.selectedConfig[t]={})}).catch(()=>{});else if(e.input.plan)for(const t in e.input.plan)t in e.input.plan&&(d.selectedConfig.plan[t]=e.input.actually[t]);E(),d.save()}async function ot(){const{name:s}=d.store.configs[d.store.selected];await T(n("REMOVE_CONFIG",[s])).then(()=>{d.removeSelected(),I()}).catch(()=>{})}async function at(){let s={};l.value&&await d.parseString(l.value).then(t=>s=t).catch(t=>{alert(t.message),console.error(t)}),d.add({actually:{...s},plan:{...s}}),l.value="",u.value=!1,I()}function rt(){const s=d.stringifyUrl();navigator.clipboard.writeText(`${v.value}?d=${s}`).then(()=>{o.value={text:n("COPIED"),color:"green"},setTimeout(()=>o.value={text:n("COPY"),color:"yellow"},2e3)}).catch(t=>{o.value={text:n("Error"),color:"red"},alert(t.message),console.error(t)})}function it(s,t){const f=b.total.intermediate[t];if(s=="plan")return{"yellow-color plus":f.plan,hide:f.plan==0};if(s=="sum"){const g=f.sum>f.actually;return{"green-color ":g,muffle:!g,hide:f.sum==0}}return{}}function Y(s,t,f){return f=typeof f=="string"?parseInt(f):f,f==0?(delete e.input[s][t],delete b[s][t]):d.selectedConfig[s][t]=f,_(),E(t),d.save(),f}function ct(s,t,f){let g=e.input.plan[t]||0;const A=e.input.actually[t];return A>g&&(g=Y("plan",t,A)),s=="plan"?f==g:e.input[s][t]==f}function ut(s,t,f){return s!="plan"||!e.input.actually?!1:f<e.input.actually[t]}function ft(s,t,f){if(s=="actually")return{none:f&&i.value.includes(f),actually:!0};if(s=="plan"){const g=f?b[s][t][f]:void 0;return{"yellow-color":(e.input.actually[t]?e.input.plan[t]>e.input.actually[t]:!0)&&typeof g!="object",plus:!f||f&&!i.value.includes(f),none:e.input.plan[t]==e.input.actually[t],plan:!0}}return{}}return(s,t)=>{const f=vt("t");return L(),R("div",null,[k(S(_t),null,{default:K(()=>[p("title",null,M(c.value),1)]),_:1}),p("h1",Ut,M(c.value),1),p("table",Ft,[(L(!0),R(j,null,G(S(b).total.intermediate,(g,A)=>(L(),R("tr",{key:A},[p("td",{class:U([S(V)(A),"stats-style"])},M(m.key(A)),3),(L(!0),R(j,null,G(g,(dt,Z)=>(L(),R("td",{key:A+Z,class:U(it(Z,A))},M(dt.toLocaleString("ru-RU")),3))),128))]))),128)),(L(!0),R(j,null,G(S(b).total.result,(g,A)=>(L(),R("tr",{key:A,class:"result"},[p("td",{class:U([S(V)(A),"stats-style"])},M(m.key(A)),3),g>0?(L(),R("td",Nt,[p("b",null,M(m.value(A,g)),1)])):At("",!0)]))),128))]),p("div",kt,[p("button",{class:"settings",onClick:t[0]||(t[0]=g=>D.value=!0)}),p("div",jt,[p("button",{class:"button yellow",name:"plan",onClick:$},M(s.$t("RESET_PLAN")),1),p("button",{class:"button red",name:"all",onClick:$},M(s.$t("RESET_ALL")),1)])]),k(Q,{open:D.value,"onUpdate:open":[t[6]||(t[6]=g=>D.value=g),t[7]||(t[7]=()=>S(d).save())],title:s.$t("CALCULATOR_SETTINGS"),size:S(X).MEDIUM},{body:K(()=>[p("div",Gt,[p("div",Pt,[w(p("p",{class:U(["stats-style",S(V)("CreditStorage")])},null,2),[[f,"TID_PLANET_UPG_CREDIT_YIELD"]]),p("input",{value:s.$store.state.userSettings.calcDayCreditLimit,type:"number",min:"0",onInput:t[1]||(t[1]=g=>s.$store.commit(S(bt).SET_CALC_DAY_CREDIT_LIMIT,parseInt(g.target.value)))},null,40,Bt)]),p("div",Kt,[w(p("p",null,null,512),[[f,"CONFIG"]]),p("div",Vt,[p("button",{class:U(`button ${o.value.color}`),onClick:rt},M(o.value.text),3),w(p("button",{class:"button green",onClick:t[2]||(t[2]=g=>u.value=!0)},null,512),[[f,"CREATE"]])])]),p("div",Jt,[w(p("p",zt,null,512),[[f,"LIST"]]),w(p("select",{"onUpdate:modelValue":t[3]||(t[3]=g=>S(d).store.selected=g),onChange:t[4]||(t[4]=g=>I())},[(L(!0),R(j,null,G(S(d).store.configs,(g,A)=>(L(),R("option",{key:A,value:A},M(g.name),9,Ht))),128))],544),[[St,S(d).store.selected]])]),p("div",Yt,[w(p("p",Zt,null,512),[[f,"TID_CHANGE_NAME_TITLE"]]),w(p("input",{"onUpdate:modelValue":t[5]||(t[5]=g=>S(d).store.configs[S(d).store.selected].name=g),placeholder:s.$t("TID_CORP_NAME_LABEL")},null,8,qt),[[W,S(d).store.configs[S(d).store.selected].name]])]),p("div",Wt,[w(p("button",{class:"button red",onClick:ot},null,512),[[f,"TID_SOCIAL_DELETE_MESSAGE"]])])])]),_:1},8,["open","title","size"]),k(wt,{onSetShow:y}),k(Q,{open:u.value,"onUpdate:open":t[9]||(t[9]=g=>u.value=g),title:s.$t("CREATE"),size:S(X).SMALL},{body:K(()=>[p("div",Xt,[w(p("p",Qt,null,512),[[f,"FROM_TEXT_FORMAT"]]),te,w(p("input",{"onUpdate:modelValue":t[8]||(t[8]=g=>l.value=g)},null,512),[[W,l.value]])]),p("div",ee,[w(p("button",{class:"button green",onClick:at},null,512),[[f,"TID_OK"]])])]),_:1},8,["open","title","size"])])}}}),ie=Tt(ne,[["__scopeId","data-v-1a125565"]]);export{ie as C};
