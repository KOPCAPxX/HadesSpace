var ht=Object.defineProperty;var gt=(o,i,s)=>i in o?ht(o,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[i]=s;var K=(o,i,s)=>(gt(o,typeof i!="symbol"?i+"":i,s),s);import{m as ot,A as mt,aF as W,aJ as yt,d as Ct,g as vt,O as bt,j as _t,l as N,a as B,aK as St,r as Et,o as L,b as D,e as j,h as V,f as h,t as R,u as E,H as At,F as G,D as k,w,C as F,B as It,aL as Ot,K as X,S as Q,M as tt,G as Tt,p as wt,i as Lt,_ as Dt}from"./index-bIDuJvz9.js";import{C as Rt}from"./TheConfirm-Pu7z3bDr.js";import{o as Y,i as et,k as Mt,v as xt}from"./Data-Xk5W5PoH.js";import{s as J}from"./globals-zpsYnYkF.js";function $t(o,i){const s=ot({actually:{},plan:{},total:{intermediate:{},result:{}}}),u={};for(const p of o)s.total.result[p]=0;const e=i(u,s);return{provideGetterElements:C,output:s,update:b};function C(p){return p(x,u)}function b(p,a){const r=(l,v)=>I(l,([y],_,A)=>m(Object.fromEntries(A),y,p.actually[l],v)),c=(l,v)=>I(l,([,y])=>Array.isArray(y)?y[v-1]:y);a?(f(s.plan,a,r(a,p.plan[a])),f(s.actually,a,c(a,p.actually[a]))):(O(p.plan,s.plan,r),O(p.actually,s.actually,c)),M(s.total);for(const[l,v]of Object.entries(s.plan))if(Object.keys(v).length){for(const y of o)s.total.result[y]+=v[y];e(l,p)}}function I(p,a){return(...r)=>{const[[c]]=r;if(H(u[p][c])){const v=Y(u[p][c],{map:(...y)=>[y[0][0],a(...y)]});return[c,v]}const l=a(...r);return[c,l]}}function f(p,a,r){u[a]&&(p[a]=Y(u[a],{map:r}))}function O(p,a,r){if(Object.keys(p).length)for(const[c,l]of Object.entries(p))l?f(a,c,r(c,l)):a[c]={};else for(const c of Object.keys(a))delete a[c]}function m(p,a,r,c){const l=p[a],v=r>0?l[r-1]:0;let y=l[c-1];if(!Array.isArray(l))return!r&&c?l:0;if(o.includes(a)){y=0;let _=r>0?r-1:0;for(;_<=c-1;)y+=l[_],_++}return y-v}function M(p){for(const a in p)if(a in p){if(H(p[a])){M(p[a]);continue}p[a]=0}}function x(p,a){const r=Ut(p);return c(r),r;function c(l){for(const v in l)if(v in l){const y=l[v],_=typeof y[1]=="boolean"?y[0]:y;if(H(_)){const A=x(_,a);Object.keys(A).length?l[v]=A:delete l[v];continue}else if(!(Array.isArray(_)&&_.length==a)&&!o.includes(v)){delete l[v];continue}typeof y[1]=="boolean"&&(l[v]=_)}return l}}}function H(o){return typeof o=="object"&&!Array.isArray(o)&&o!==null}function Ut(o){const i=mt(),s=Y(o,{map:([u,e])=>[u,[e,et(u,o.Name)]],filter:([u,[,e]])=>{var C,b;return u.startsWith("_")||et(u,null,{asMeta:!0,asTitle:!1})?!1:(b=(C=i==null?void 0:i.state)==null?void 0:C.userSettings)!=null&&b.disableFilters?!0:!e}});if(o.projectile){const{projectile:u}=s;delete s.projectile,s.projectile=u}return s}const nt={crush:(o,i=50)=>{const s="",u=(f,O)=>{let m=O.length,M="";const x=r=>encodeURI(encodeURIComponent(r)).replace(/%../g,"i").length,p=r=>{let c=r.charCodeAt(0),l=r.charCodeAt(r.length-1);return c>=56320&&c<=57343||l>=55296&&l<=56319};let a={};for(let r=2;r<i;r++)for(let c=0;c<f.length-r;++c){let l=f.substr(c,r);if(a[l]||p(l))continue;let v=1;for(let y=f.indexOf(l,c+r);y>=0;++v)y=f.indexOf(l,y+r);v>1&&(a[l]=v)}for(;;){for(;m--&&f.includes(O[m]););if(m<0)break;let r=O[m],c,l=0,v=x(r);for(let _ in a){let A=a[_],T=(A-1)*x(_)-(A+1)*v;M.length||(T-=x(s)),T<=0?delete a[_]:T>l&&(c=_,l=T)}if(!c)break;f=f.split(c).join(r)+r+c,M=r+M;let y={};for(let _ in a){let A=_.split(c).join(r),T=0;for(let $=f.indexOf(A);$>=0;++T)$=f.indexOf(A,$+A.length);T>1&&(y[A]=T)}a=y}return{a:f,b:M}};let e=[];const C="-_.!~*'()";for(let f=127;--f;)(f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||C.includes(String.fromCharCode(f)))&&e.push(String.fromCharCode(f));for(let f=32;f<255;++f){let O=String.fromCharCode(f);O!="\\"&&!e.includes(O)&&e.unshift(O)}o=o.replace(new RegExp(s,"g"),""),o=st(o);const b=u(o,e);let I=b.a;return b.b.length&&(I+=s+b.b),I+="_",I},uncrush:o=>{o=o.substring(0,o.length-1);const i=o.split("");let s=i[0];if(i.length>1){let u=i[1];for(let e of u){let C=s.split(e);s=C.join(C.pop())}}return st(s,0)}},st=(o,i=1)=>{const s=[['"',"'"],["':","!"],[",'","~"],["}",")","\\","\\"],["{","(","\\","\\"]],u=(e,C)=>{let b=new RegExp(`${(C[2]?C[2]:"")+C[0]}|${(C[3]?C[3]:"")+C[1]}`,"g");return e.replace(b,I=>I===C[0]?C[1]:C[0])};if(i)for(let e=0;e<s.length;++e)o=u(o,s[e]);else for(let e=s.length;e--;)o=u(o,s[e]);return o},lt="new entry",z="en";class Ft{constructor(i){K(this,"store");K(this,"TIDs",{});this.localStoreKey=i,this.store=ot({configs:[],selected:0}),this.load()}get selectedConfig(){return this.store.configs[this.store.selected].value}load(){const i=JSON.parse(localStorage.getItem(this.localStoreKey)||"{}");if(i.configs){Object.assign(this.store,i);return}if(Object.keys(i).length&&i.actually&&i.plan){this.add(i);return}this.add()}save(){localStorage.setItem(this.localStoreKey,JSON.stringify(this.store))}removeSelected(){if(this.store.configs.splice(this.store.selected,1),this.store.configs.length==0){this.add();return}this.store.selected=this.store.configs.length-1}add(i,{temporary:s}={temporary:!1}){const u=this.store;let e=0,C;do C=e?`${lt} #${e}`:lt,e++;while(u.configs.length&&u.configs.some(b=>b.name==C));u.configs=[...u.configs,{name:C,value:i||{actually:{},plan:{}}}],u.selected=u.configs.length-1,s||this.save()}async parseString(i){const s=[];W.global.availableLocales.includes(z)||await yt(z);for(const[u,e]of Object.entries(this.TIDs)){const C=W.global.t(e,z),b=new RegExp(`${C}\\s+?(\\d+)\\s?`,"mi"),[,I]=i.match(b)||[void 0,"0"];s.push([u,parseInt(I)])}return Object.fromEntries(s.filter(([,u])=>u))}stringifyUrl(){const i=JSON.stringify(this.selectedConfig.actually);return nt.crush(i)}parseUrl(i){return JSON.parse(nt.uncrush(i))}}const Nt=o=>(wt("data-v-bffa073c"),o=o(),Lt(),o),jt={class:"topic"},Gt={class:"total-table"},kt={key:0,colspan:"3"},Pt={class:"buttons"},Kt={class:"reset-buttons"},Bt={class:"settings-modal"},Vt={class:"input-wrap"},Jt=["value"],Ht={class:"config-category"},zt={class:"flex-end"},Yt={class:"select"},Zt={class:"name"},qt=["value"],Wt={class:"input"},Xt={class:"name"},Qt=["placeholder"],te={class:"flex-end margin-bottom"},ee={class:"input"},ne={class:"name"},se=Nt(()=>h("p",{class:"name"},"Example: Fortify 8 Bond 5",-1)),le={class:"flex-end margin-bottom"},oe=Ct({__name:"Calculator",props:{stackChars:{},calcTotal:{},localStorageKey:{},titleKey:{},input:{}},emits:["update:input","setup"],setup(o,{emit:i}){const{t:s}=vt(),u=bt(),e=o,C=i,b={key:n=>Mt(n,u.currentRoute.value.name),value:(n,t)=>xt(n,t,u.currentRoute.value.name)},{provideGetterElements:I,output:f,update:O}=$t(e.stackChars,e.calcTotal),m=new Ft(e.localStorageKey),M=_t(n=>{T(),$(n),m.save()},100),x={output:f,onChangeLvl:P,isSelected:ut,isDisabled:ft,outputClasses:dt,forceReCalc:U,format:b,provideGetterElements:n=>I((...t)=>n(m.TIDs,...t))};let p=()=>Promise.prototype;const a=N(!1),r=N(!1),c=N(""),l=N({text:s("COPY"),color:"yellow"}),v=B(()=>s(e.titleKey)),y=B(()=>Object.keys(f.total.result)),_=B(()=>`${location.origin}${location.pathname}`);if(u.currentRoute.value.query.d){const n=m.parseUrl(u.currentRoute.value.query.d),t={actually:{...n},plan:{...n}};m.add(t,{temporary:!0})}U(),C("setup",x);function A(n){p=n}function T(){C("update:input",m.selectedConfig)}function $(n){St(()=>O(e.input,n))}function U(){T(),$()}async function Z(n){if(n.target.name=="all")await p("Reset all ? Are you serious ?").then(()=>{for(const t in e.input)t in e.input&&(m.selectedConfig[t]={})}).catch(()=>{});else if(e.input.plan)for(const t in e.input.plan)t in e.input.plan&&(m.selectedConfig.plan[t]=e.input.actually[t]);$(),m.save()}async function at(){const{name:n}=m.store.configs[m.store.selected];await p(s("REMOVE_CONFIG",[n])).then(()=>{m.removeSelected(),U()}).catch(()=>{})}async function rt(){let n={};c.value&&await m.parseString(c.value).then(t=>n=t).catch(t=>{alert(t.message),console.error(t)}),m.add({actually:{...n},plan:{...n}}),c.value="",r.value=!1,U()}function it(){const n=m.stringifyUrl();navigator.clipboard.writeText(`${_.value}?d=${n}`).then(()=>{l.value={text:s("COPIED"),color:"green"},setTimeout(()=>l.value={text:s("COPY"),color:"yellow"},2e3)}).catch(t=>{l.value={text:s("Error"),color:"red"},alert(t.message),console.error(t)})}function ct(n,t){const d=f.total.intermediate[t];if(n=="plan")return{"yellow-color plus":d.plan,hide:d.plan==0};if(n=="sum"){const g=d.sum>d.actually;return{"green-color ":g,muffle:!g,hide:d.sum==0}}return{}}function P(n,t,d){d=typeof d=="string"?parseInt(d):d,d==0?(delete e.input[n][t],delete f[n][t]):m.selectedConfig[n][t]=d;const g=e.input.plan[t]||0,S=e.input.actually[t];return S>g&&P("plan",t,S),M(t),d}function ut(n,t,d){let g=e.input.plan[t]||0;const S=e.input.actually[t];return S>g&&(g=P("plan",t,S)),n=="plan"?d==g:e.input[n][t]==d}function ft(n,t,d){return n!="plan"||!e.input.actually?!1:d<e.input.actually[t]}function dt(n,t,d){if(n=="actually")return{none:d&&y.value.includes(d),actually:!0};if(n=="plan"){const g=d?f[n][t][d]:void 0;return{"yellow-color":(e.input.actually[t]?e.input.plan[t]>e.input.actually[t]:!0)&&typeof g!="object",plus:!d||d&&!y.value.includes(d),none:e.input.plan[t]==e.input.actually[t],plan:!0}}return{}}return(n,t)=>{const d=Et("t");return L(),D("div",null,[j(E(At),null,{default:V(()=>[h("title",null,R(v.value),1)]),_:1}),h("h1",jt,R(v.value),1),h("table",Gt,[(L(!0),D(G,null,k(E(f).total.intermediate,(g,S)=>(L(),D("tr",{key:S},[h("td",{class:F([E(J)(S),"stats-style"])},R(b.key(S)),3),(L(!0),D(G,null,k(g,(pt,q)=>(L(),D("td",{key:S+q,class:F(ct(q,S))},R(pt.toLocaleString("ru-RU")),3))),128))]))),128)),(L(!0),D(G,null,k(E(f).total.result,(g,S)=>(L(),D("tr",{key:S,class:"result"},[h("td",{class:F([E(J)(S),"stats-style"])},R(b.key(S)),3),g>0?(L(),D("td",kt,[h("b",null,R(b.value(S,g)),1)])):Tt("",!0)]))),128))]),h("div",Pt,[h("button",{class:"settings",onClick:t[0]||(t[0]=g=>a.value=!0)}),h("div",Kt,[h("button",{class:"button yellow",name:"plan",onClick:Z},R(n.$t("RESET_PLAN")),1),h("button",{class:"button red",name:"all",onClick:Z},R(n.$t("RESET_ALL")),1)])]),j(tt,{open:a.value,"onUpdate:open":[t[6]||(t[6]=g=>a.value=g),t[7]||(t[7]=()=>E(m).save())],title:n.$t("CALCULATOR_SETTINGS"),size:E(Q).MEDIUM},{body:V(()=>[h("div",Bt,[h("div",Vt,[w(h("p",{class:F(["stats-style",E(J)("CreditStorage")])},null,2),[[d,"TID_PLANET_UPG_CREDIT_YIELD"]]),h("input",{value:n.$store.state.userSettings.calcDayCreditLimit,type:"number",min:"0",onInput:t[1]||(t[1]=g=>n.$store.commit(E(It).SET_CALC_DAY_CREDIT_LIMIT,parseInt(g.target.value)))},null,40,Jt)]),h("div",Ht,[w(h("p",null,null,512),[[d,"CONFIG"]]),h("div",zt,[h("button",{class:F(`button ${l.value.color}`),onClick:it},R(l.value.text),3),w(h("button",{class:"button green",onClick:t[2]||(t[2]=g=>r.value=!0)},null,512),[[d,"CREATE"]])])]),h("div",Yt,[w(h("p",Zt,null,512),[[d,"LIST"]]),w(h("select",{"onUpdate:modelValue":t[3]||(t[3]=g=>E(m).store.selected=g),onChange:t[4]||(t[4]=g=>U())},[(L(!0),D(G,null,k(E(m).store.configs,(g,S)=>(L(),D("option",{key:S,value:S},R(g.name),9,qt))),128))],544),[[Ot,E(m).store.selected]])]),h("div",Wt,[w(h("p",Xt,null,512),[[d,"TID_CHANGE_NAME_TITLE"]]),w(h("input",{"onUpdate:modelValue":t[5]||(t[5]=g=>E(m).store.configs[E(m).store.selected].name=g),placeholder:n.$t("TID_CORP_NAME_LABEL")},null,8,Qt),[[X,E(m).store.configs[E(m).store.selected].name]])]),h("div",te,[w(h("button",{class:"button red",onClick:at},null,512),[[d,"TID_SOCIAL_DELETE_MESSAGE"]])])])]),_:1},8,["open","title","size"]),j(Rt,{onSetShow:A}),j(tt,{open:r.value,"onUpdate:open":t[9]||(t[9]=g=>r.value=g),title:n.$t("CREATE"),size:E(Q).SMALL},{body:V(()=>[h("div",ee,[w(h("p",ne,null,512),[[d,"FROM_TEXT_FORMAT"]]),se,w(h("input",{"onUpdate:modelValue":t[8]||(t[8]=g=>c.value=g)},null,512),[[X,c.value]])]),h("div",le,[w(h("button",{class:"button green",onClick:rt},null,512),[[d,"TID_OK"]])])]),_:1},8,["open","title","size"])])}}}),fe=Dt(oe,[["__scopeId","data-v-bffa073c"]]);export{fe as C};
