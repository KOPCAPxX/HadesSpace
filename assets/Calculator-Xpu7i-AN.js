var ht=Object.defineProperty;var gt=(o,i,n)=>i in o?ht(o,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[i]=n;var K=(o,i,n)=>(gt(o,typeof i!="symbol"?i+"":i,n),n);import{m as ot,A as yt,aI as W,aL as mt,d as Ct,g as bt,O as vt,j as _t,l as F,a as B,aM as St,r as Et,o as L,b as D,e as j,h as V,f as h,t as R,u as E,H as It,F as G,D as k,w,C as N,B as At,aN as Ot,K as X,S as Q,M as tt,G as Tt,p as wt,i as Lt,_ as Dt}from"./index-Zq0Xsckh.js";import{C as Rt}from"./TheConfirm-7oOiKun6.js";import{o as Y,i as et,k as Mt,v as xt}from"./Data-jPtE7ZvQ.js";import{s as J}from"./globals-zpsYnYkF.js";function $t(o,i){const n=ot({actually:{},plan:{},total:{intermediate:{},result:{}}}),u={};for(const p of o)n.total.result[p]=0;const e=i(u,n);return{provideGetterElements:C,output:n,update:v};function C(p){return p(x,u)}function v(p,a){const r=(l,b)=>A(l,([m],_,I)=>y(Object.fromEntries(I),m,p.actually[l],b)),c=(l,b)=>A(l,([,m])=>Array.isArray(m)?m[b-1]:m);a?(f(n.plan,a,r(a,p.plan[a])),f(n.actually,a,c(a,p.actually[a]))):(O(p.plan,n.plan,r),O(p.actually,n.actually,c)),M(n.total);for(const[l,b]of Object.entries(n.plan))if(Object.keys(b).length){for(const m of o)n.total.result[m]+=b[m];e(l,p)}}function A(p,a){return(...r)=>{const[[c]]=r;if(H(u[p][c])){const b=Y(u[p][c],{map:(...m)=>[m[0][0],a(...m)]});return[c,b]}const l=a(...r);return[c,l]}}function f(p,a,r){u[a]&&(p[a]=Y(u[a],{map:r}))}function O(p,a,r){if(Object.keys(p).length)for(const[c,l]of Object.entries(p))l?f(a,c,r(c,l)):a[c]={};else for(const c of Object.keys(a))delete a[c]}function y(p,a,r,c){const l=p[a],b=r>0?l[r-1]:0;let m=l[c-1];if(!Array.isArray(l))return!r&&c?l:0;if(o.includes(a)){m=0;let _=r>0?r-1:0;for(;_<=c-1;)m+=l[_],_++}return m-b}function M(p){for(const a in p)if(a in p){if(H(p[a])){M(p[a]);continue}p[a]=0}}function x(p,a){const r=Ut(p);return c(r),r;function c(l){for(const b in l)if(b in l){const m=l[b],_=typeof m[1]=="boolean"?m[0]:m;if(H(_)){const I=x(_,a);Object.keys(I).length?l[b]=I:delete l[b];continue}else if(!(Array.isArray(_)&&_.length==a)&&!o.includes(b)){delete l[b];continue}typeof m[1]=="boolean"&&(l[b]=_)}return l}}}function H(o){return typeof o=="object"&&!Array.isArray(o)&&o!==null}function Ut(o){const i=yt(),n=Y(o,{map:([u,e])=>[u,[e,et(u,o.Name)]],filter:([u,[,e]])=>{var C,v;return u.startsWith("_")||et(u,null,{asMeta:!0,asTitle:!1})?!1:(v=(C=i==null?void 0:i.state)==null?void 0:C.userSettings)!=null&&v.disableFilters?!0:!e}});if(o.projectile){const{projectile:u}=n;delete n.projectile,n.projectile=u}return n}const nt={crush:(o,i=50)=>{const n="",u=(f,O)=>{let y=O.length,M="";const x=r=>encodeURI(encodeURIComponent(r)).replace(/%../g,"i").length,p=r=>{let c=r.charCodeAt(0),l=r.charCodeAt(r.length-1);return c>=56320&&c<=57343||l>=55296&&l<=56319};let a={};for(let r=2;r<i;r++)for(let c=0;c<f.length-r;++c){let l=f.substr(c,r);if(a[l]||p(l))continue;let b=1;for(let m=f.indexOf(l,c+r);m>=0;++b)m=f.indexOf(l,m+r);b>1&&(a[l]=b)}for(;;){for(;y--&&f.includes(O[y]););if(y<0)break;let r=O[y],c,l=0,b=x(r);for(let _ in a){let I=a[_],T=(I-1)*x(_)-(I+1)*b;M.length||(T-=x(n)),T<=0?delete a[_]:T>l&&(c=_,l=T)}if(!c)break;f=f.split(c).join(r)+r+c,M=r+M;let m={};for(let _ in a){let I=_.split(c).join(r),T=0;for(let $=f.indexOf(I);$>=0;++T)$=f.indexOf(I,$+I.length);T>1&&(m[I]=T)}a=m}return{a:f,b:M}};let e=[];const C="-_.!~*'()";for(let f=127;--f;)(f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||C.includes(String.fromCharCode(f)))&&e.push(String.fromCharCode(f));for(let f=32;f<255;++f){let O=String.fromCharCode(f);O!="\\"&&!e.includes(O)&&e.unshift(O)}o=o.replace(new RegExp(n,"g"),""),o=st(o);const v=u(o,e);let A=v.a;return v.b.length&&(A+=n+v.b),A+="_",A},uncrush:o=>{o=o.substring(0,o.length-1);const i=o.split("");let n=i[0];if(i.length>1){let u=i[1];for(let e of u){let C=n.split(e);n=C.join(C.pop())}}return st(n,0)}},st=(o,i=1)=>{const n=[['"',"'"],["':","!"],[",'","~"],["}",")","\\","\\"],["{","(","\\","\\"]],u=(e,C)=>{let v=new RegExp(`${(C[2]?C[2]:"")+C[0]}|${(C[3]?C[3]:"")+C[1]}`,"g");return e.replace(v,A=>A===C[0]?C[1]:C[0])};if(i)for(let e=0;e<n.length;++e)o=u(o,n[e]);else for(let e=n.length;e--;)o=u(o,n[e]);return o},lt="new entry",z="en";class Nt{constructor(i){K(this,"store");K(this,"TIDs",{});this.localStoreKey=i,this.store=ot({configs:[],selected:0}),this.load()}get selectedConfig(){return this.store.configs[this.store.selected].value}load(){const i=JSON.parse(localStorage.getItem(this.localStoreKey)||"{}");if(i.configs){Object.assign(this.store,i);return}if(Object.keys(i).length&&i.actually&&i.plan){this.add(i);return}this.add()}save(){localStorage.setItem(this.localStoreKey,JSON.stringify(this.store))}removeSelected(){if(this.store.configs.splice(this.store.selected,1),this.store.configs.length==0){this.add();return}this.store.selected=this.store.configs.length-1}add(i,{temporary:n}={temporary:!1}){const u=this.store;let e=0,C;do C=e?`${lt} #${e}`:lt,e++;while(u.configs.length&&u.configs.some(v=>v.name==C));u.configs=[...u.configs,{name:C,value:i||{actually:{},plan:{}}}],u.selected=u.configs.length-1,n||this.save()}async parseString(i){const n=[];W.global.availableLocales.includes(z)||await mt(z);for(const[u,e]of Object.entries(this.TIDs)){const C=W.global.t(e,z),v=new RegExp(`${C}\\s+?(\\d+)\\s?`,"mi"),[,A]=i.match(v)||[void 0,"0"];n.push([u,parseInt(A)])}return Object.fromEntries(n.filter(([,u])=>u))}stringifyUrl(){const i=JSON.stringify(this.selectedConfig.actually);return nt.crush(i)}parseUrl(i){return JSON.parse(nt.uncrush(i))}}const Ft=o=>(wt("data-v-b0bc2117"),o=o(),Lt(),o),jt={class:"topic"},Gt={class:"total-table"},kt={key:0,colspan:"3"},Pt={class:"buttons"},Kt={class:"reset-buttons"},Bt={class:"settings-modal"},Vt={class:"input-wrap"},Jt=["value"],Ht={class:"config-category"},zt={class:"flex-end"},Yt={class:"select"},Zt={class:"name"},qt=["value"],Wt={class:"input"},Xt={class:"name"},Qt=["placeholder"],te={class:"flex-end margin-bottom"},ee={class:"input"},ne={class:"name"},se=Ft(()=>h("p",{class:"name"},"Example: Fortify 8 Bond 5",-1)),le={class:"flex-end margin-bottom"},oe=Ct({__name:"Calculator",props:{stackChars:{},calcTotal:{},localStorageKey:{},titleKey:{},input:{}},emits:["update:input","setup"],setup(o,{emit:i}){const{t:n}=bt(),u=vt(),e=o,C=i,v={key:s=>Mt(s,u.currentRoute.value.name),value:(s,t)=>xt(s,t,u.currentRoute.value.name)},{provideGetterElements:A,output:f,update:O}=$t(e.stackChars,e.calcTotal),y=new Nt(e.localStorageKey),M=_t(()=>{T(),$(),y.save()},100),x={output:f,onChangeLvl:P,isSelected:ut,isDisabled:ft,outputClasses:dt,forceReCalc:U,format:v,provideGetterElements:s=>A((...t)=>s(y.TIDs,...t))};let p=()=>Promise.prototype;const a=F(!1),r=F(!1),c=F(""),l=F({text:n("COPY"),color:"yellow"}),b=B(()=>n(e.titleKey)),m=B(()=>Object.keys(f.total.result)),_=B(()=>`${location.origin}${location.pathname}`);if(u.currentRoute.value.query.d){const s=y.parseUrl(u.currentRoute.value.query.d),t={actually:{...s},plan:{...s}};y.add(t,{temporary:!0})}U(),C("setup",x);function I(s){p=s}function T(){C("update:input",y.selectedConfig)}function $(s){St(()=>O(e.input,s))}function U(){T(),$()}async function Z(s){if(s.target.name=="all")await p("Reset all ? Are you serious ?").then(()=>{for(const t in e.input)t in e.input&&(y.selectedConfig[t]={})}).catch(()=>{});else if(e.input.plan)for(const t in e.input.plan)t in e.input.plan&&(y.selectedConfig.plan[t]=e.input.actually[t]);$(),y.save()}async function at(){const{name:s}=y.store.configs[y.store.selected];await p(n("REMOVE_CONFIG",[s])).then(()=>{y.removeSelected(),U()}).catch(()=>{})}async function rt(){let s={};c.value&&await y.parseString(c.value).then(t=>s=t).catch(t=>{alert(t.message),console.error(t)}),y.add({actually:{...s},plan:{...s}}),c.value="",r.value=!1,U()}function it(){const s=y.stringifyUrl();navigator.clipboard.writeText(`${_.value}?d=${s}`).then(()=>{l.value={text:n("COPIED"),color:"green"},setTimeout(()=>l.value={text:n("COPY"),color:"yellow"},2e3)}).catch(t=>{l.value={text:n("Error"),color:"red"},alert(t.message),console.error(t)})}function ct(s,t){const d=f.total.intermediate[t];if(s=="plan")return{"yellow-color plus":d.plan,hide:d.plan==0};if(s=="sum"){const g=d.sum>d.actually;return{"green-color ":g,muffle:!g,hide:d.sum==0}}return{}}function P(s,t,d){d=typeof d=="string"?parseInt(d):d,d==0?(delete e.input[s][t],delete f[s][t]):y.selectedConfig[s][t]=d;const g=e.input.plan[t]||0,S=e.input.actually[t];return S>g&&P("plan",t,S),M(),d}function ut(s,t,d){let g=e.input.plan[t]||0;const S=e.input.actually[t];return S>g&&(g=P("plan",t,S)),s=="plan"?d==g:e.input[s][t]==d}function ft(s,t,d){return s!="plan"||!e.input.actually?!1:d<e.input.actually[t]}function dt(s,t,d){if(s=="actually")return{none:d&&m.value.includes(d),actually:!0};if(s=="plan"){const g=d?f[s][t][d]:void 0;return{"yellow-color":(e.input.actually[t]?e.input.plan[t]>e.input.actually[t]:!0)&&typeof g!="object",plus:!d||d&&!m.value.includes(d),none:e.input.plan[t]==e.input.actually[t],plan:!0}}return{}}return(s,t)=>{const d=Et("t");return L(),D("div",null,[j(E(It),null,{default:V(()=>[h("title",null,R(b.value),1)]),_:1}),h("h1",jt,R(b.value),1),h("table",Gt,[(L(!0),D(G,null,k(E(f).total.intermediate,(g,S)=>(L(),D("tr",{key:S},[h("td",{class:N([E(J)(S),"stats-style"])},R(v.key(S)),3),(L(!0),D(G,null,k(g,(pt,q)=>(L(),D("td",{key:S+q,class:N(ct(q,S))},R(pt.toLocaleString("ru-RU")),3))),128))]))),128)),(L(!0),D(G,null,k(E(f).total.result,(g,S)=>(L(),D("tr",{key:S,class:"result"},[h("td",{class:N([E(J)(S),"stats-style"])},R(v.key(S)),3),g>0?(L(),D("td",kt,[h("b",null,R(v.value(S,g)),1)])):Tt("",!0)]))),128))]),h("div",Pt,[h("button",{class:"settings",onClick:t[0]||(t[0]=g=>a.value=!0)}),h("div",Kt,[h("button",{class:"button yellow",name:"plan",onClick:Z},R(s.$t("RESET_PLAN")),1),h("button",{class:"button red",name:"all",onClick:Z},R(s.$t("RESET_ALL")),1)])]),j(tt,{open:a.value,"onUpdate:open":[t[6]||(t[6]=g=>a.value=g),t[7]||(t[7]=()=>E(y).save())],title:s.$t("CALCULATOR_SETTINGS"),size:E(Q).MEDIUM},{body:V(()=>[h("div",Bt,[h("div",Vt,[w(h("p",{class:N(["stats-style",E(J)("CreditStorage")])},null,2),[[d,"TID_PLANET_UPG_CREDIT_YIELD"]]),h("input",{value:s.$store.state.userSettings.calcDayCreditLimit,type:"number",min:"0",onInput:t[1]||(t[1]=g=>s.$store.commit(E(At).SET_CALC_DAY_CREDIT_LIMIT,parseInt(g.target.value)))},null,40,Jt)]),h("div",Ht,[w(h("p",null,null,512),[[d,"CONFIG"]]),h("div",zt,[h("button",{class:N(`button ${l.value.color}`),onClick:it},R(l.value.text),3),w(h("button",{class:"button green",onClick:t[2]||(t[2]=g=>r.value=!0)},null,512),[[d,"CREATE"]])])]),h("div",Yt,[w(h("p",Zt,null,512),[[d,"LIST"]]),w(h("select",{"onUpdate:modelValue":t[3]||(t[3]=g=>E(y).store.selected=g),onChange:t[4]||(t[4]=g=>U())},[(L(!0),D(G,null,k(E(y).store.configs,(g,S)=>(L(),D("option",{key:S,value:S},R(g.name),9,qt))),128))],544),[[Ot,E(y).store.selected]])]),h("div",Wt,[w(h("p",Xt,null,512),[[d,"TID_CHANGE_NAME_TITLE"]]),w(h("input",{"onUpdate:modelValue":t[5]||(t[5]=g=>E(y).store.configs[E(y).store.selected].name=g),placeholder:s.$t("TID_CORP_NAME_LABEL")},null,8,Qt),[[X,E(y).store.configs[E(y).store.selected].name]])]),h("div",te,[w(h("button",{class:"button red",onClick:at},null,512),[[d,"TID_SOCIAL_DELETE_MESSAGE"]])])])]),_:1},8,["open","title","size"]),j(Rt,{onSetShow:I}),j(tt,{open:r.value,"onUpdate:open":t[9]||(t[9]=g=>r.value=g),title:s.$t("CREATE"),size:E(Q).SMALL},{body:V(()=>[h("div",ee,[w(h("p",ne,null,512),[[d,"FROM_TEXT_FORMAT"]]),se,w(h("input",{"onUpdate:modelValue":t[8]||(t[8]=g=>c.value=g)},null,512),[[X,c.value]])]),h("div",le,[w(h("button",{class:"button green",onClick:rt},null,512),[[d,"TID_OK"]])])]),_:1},8,["open","title","size"])])}}}),fe=Dt(oe,[["__scopeId","data-v-b0bc2117"]]);export{fe as C};
