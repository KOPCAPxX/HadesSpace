import{j as ot,s as tt,d as ut,g as it,aI as rt,aK as ct,i as N,a as J,z as pt,aL as ft,r as dt,o as I,b as T,e as L,h as $,f as c,t as M,u as g,H as yt,F as V,B as j,w as O,A as z,x as mt,S as k,M as B,J as vt,K as Ct,L as _t,E as W,p as gt,q as bt,_ as At}from"./index-_kXwJzCr.js";import{M as X,a as It}from"./MultiConfigGUI-8n5GzGAi.js";import{o as q,i as Q,k as Tt,v as Et}from"./Data-cwX2Jl1B.js";import{s as P}from"./globals-zpsYnYkF.js";function Mt(d,S){const m=ot({actually:{},plan:{},total:{intermediate:{},result:{}}}),C={};for(const l of d)m.total.result[l]=0;const h=S(C,m);return{provideGetterElements:b,output:m,update:o};function b(l){return l(y,C)}function o(l,n){const f=(a,r)=>w(a,([p],_,R)=>A(Object.fromEntries(R),p,l.actually[a],r)),i=(a,r)=>w(a,([,p])=>Array.isArray(p)?p[r-1]:p);n?(E(m.plan,n,f(n,l.plan[n])),E(m.actually,n,i(n,l.actually[n]))):(D(l.plan,m.plan,f),D(l.actually,m.actually,i)),U(m.total);for(const[a,r]of Object.entries(m.plan))if(Object.keys(r).length){for(const p of d)m.total.result[p]+=r[p];h(a,l)}}function w(l,n){return(...f)=>{const[[i]]=f;if(H(C[l][i])){const r=q(C[l][i],{map:(...p)=>[p[0][0],n(...p)]});return[i,r]}const a=n(...f);return[i,a]}}function E(l,n,f){C[n]&&(l[n]=q(C[n],{map:f}))}function D(l,n,f){if(Object.keys(l).length)for(const[i,a]of Object.entries(l))a?E(n,i,f(i,a)):n[i]={};else for(const i of Object.keys(n))delete n[i]}function A(l,n,f,i){const a=l[n],r=f>0?a[f-1]:0;let p=a[i-1];if(!Array.isArray(a))return!f&&i?a:0;if(d.includes(n)){p=0;let _=f>0?f-1:0;for(;_<=i-1;)p+=a[_],_++}return p-r}function U(l){for(const n in l)if(n in l){if(H(l[n])){U(l[n]);continue}l[n]=0}}function y(l,n){const f=St(l);return i(f),f;function i(a){for(const r in a)if(r in a){const p=a[r],_=typeof p[1]=="boolean"?p[0]:p;if(H(_)){const R=y(_,n);Object.keys(R).length?a[r]=R:delete a[r];continue}else if(!(Array.isArray(_)&&_.length==n)&&!d.includes(r)){delete a[r];continue}typeof p[1]=="boolean"&&(a[r]=_)}return a}}}function H(d){return typeof d=="object"&&!Array.isArray(d)&&d!==null}function St(d){const S=tt(),m=q(d,{map:([C,h])=>[C,[h,Q(C,d.Name)]],filter:([C,[,h]])=>{var b,o;return C.startsWith("_")||Q(C,null,{asMeta:!0,asTitle:!1})?!1:(o=(b=S==null?void 0:S.state)==null?void 0:b.userSettings)!=null&&o.disableFilters?!0:!h}});if(d.projectile){const{projectile:C}=m;delete m.projectile,m.projectile=C}return m}const ht=d=>(gt("data-v-7d26eb91"),d=d(),bt(),d),Rt={class:"topic"},wt={class:"table-and-buttons"},Lt={class:"total-table"},Ot={key:0,colspan:"3"},Dt={class:"buttons"},Ut={class:"reset-buttons"},Ft={class:"settings-modal"},Nt={class:"input-wrap"},$t=["value"],zt={class:"input"},Gt={class:"name"},Kt=ht(()=>c("p",{class:"name"},"Example: Fortify 8 Bond 5",-1)),Vt={class:"flex-end margin-bottom"},jt={class:"info"},kt=ut({__name:"Calculator",props:{stackChars:{},calcTotal:{},localStorageKey:{},titleKey:{},input:{}},emits:["update:input","setup"],setup(d,{emit:S}){const m=X,C=tt(),{t:h}=it(),b=rt(),o=d,w=S,E={key:e=>Tt(e,b.currentRoute.value.name),value:(e,t)=>Et(e,t,b.currentRoute.value.name)},{provideGetterElements:D,output:A,update:U}=Mt(o.stackChars,o.calcTotal),y=new m(o.localStorageKey,{actually:{},plan:{}}),l=ct(()=>{R(),G(),y.save()},100),n={output:A,onChangeLvl:K,isSelected:st,isDisabled:lt,outputClasses:at,forceReCalc:F,format:E,Config:y.store,provideGetterElements:e=>D((...t)=>e(y.TIDs,...t))},f=N(!1),i=N(!1),a=N(!1),r=N(""),p=J(()=>h(o.titleKey)),_=J(()=>Object.keys(A.total.result));if(b.currentRoute.value.query.d){const e=X.parseUrl(b.currentRoute.value.query.d),t={actually:{...e},plan:{...e}};y.add(t,{temporary:!0})}F(),w("setup",n),pt(()=>y.store.selected,()=>{F()});function R(){w("update:input",y.selectedConfig)}function G(e){ft(()=>U(o.input,e))}function F(){R(),G()}async function x(e){if(e.target.name=="all")await C.dispatch(Ct.OPEN_CONFIRM,"Reset all ? Are you serious ?").then(()=>{for(const t in o.input)t in o.input&&(y.selectedConfig[t]={})}).catch(()=>{});else if(o.input.plan)for(const t in o.input.plan)t in o.input.plan&&(y.selectedConfig.plan[t]=o.input.actually[t]);G(),y.save()}async function et(){let e={};r.value&&await y.parseString(r.value).then(t=>e=t).catch(t=>{alert(t.message),console.error(t)}),y.add({actually:{...e},plan:{...e}}),r.value="",i.value=!1,F()}function nt(e,t){const s=A.total.intermediate[t];if(e=="plan")return{"yellow-color plus":s.plan,hide:s.plan==0};if(e=="sum"){const u=s.sum>s.actually;return{"green-color ":u,muffle:!u,hide:s.sum==0}}return{}}function K(e,t,s){s=typeof s=="string"?parseInt(s):s,s==0?(delete o.input[e][t],delete A[e][t]):y.selectedConfig[e][t]=s;const u=o.input.plan[t]||0,v=o.input.actually[t];return v>u&&K("plan",t,v),l(),s}function st(e,t,s){let u=o.input.plan[t]||0;const v=o.input.actually[t];return v>u&&(u=K("plan",t,v)),e=="plan"?s==u:o.input[e][t]==s}function lt(e,t,s){return e!="plan"||!o.input.actually?!1:s<o.input.actually[t]}function at(e,t,s){if(e=="actually")return{none:!!s&&_.value.includes(s),actually:!0};if(e=="plan"){const u=s?A[e][t][s]:void 0;return{"yellow-color":(o.input.actually[t]?o.input.plan[t]>o.input.actually[t]:!0)&&typeof u!="object",plus:!s||!!s&&!_.value.includes(s),none:o.input.plan[t]==o.input.actually[t],plan:!0}}return{}}return(e,t)=>{const s=dt("t");return I(),T("div",null,[L(g(yt),null,{default:$(()=>[c("title",null,M(p.value),1)]),_:1}),c("h1",Rt,M(p.value),1),c("div",wt,[c("table",Lt,[(I(!0),T(V,null,j(g(A).total.intermediate,(u,v)=>(I(),T("tr",{key:v},[c("td",{class:z([g(P)(v),"stats-style"])},M(E.key(v)),3),(I(!0),T(V,null,j(u,(Y,Z)=>(I(),T("td",{key:v+Z,class:z(nt(Z,v))},M(Y.toLocaleString("ru-RU")),3))),128))]))),128)),(I(!0),T(V,null,j(g(A).total.result,(u,v)=>(I(),T("tr",{key:v,class:"result"},[c("td",{class:z([g(P)(v),"stats-style"])},[_t(M(E.key(v))+" ",1),v=="TimeToUpgradeParallel"?(I(),T("span",{key:0,class:"show-info",onClick:t[0]||(t[0]=Y=>a.value=!0)})):W("",!0)],2),u>0?(I(),T("td",Ot,[c("b",null,M(E.value(v,u)),1)])):W("",!0)]))),128))]),c("div",Dt,[c("div",Ut,[c("button",{class:"button yellow",name:"plan",onClick:x},M(e.$t("RESET_PLAN")),1),c("button",{class:"button red",name:"all",onClick:x},M(e.$t("RESET_ALL")),1)]),c("button",{class:"settings",onClick:t[1]||(t[1]=u=>f.value=!0)})])]),L(B,{open:f.value,"onUpdate:open":[t[3]||(t[3]=u=>f.value=u),t[4]||(t[4]=()=>g(y).save())],title:e.$t("CALCULATOR_SETTINGS"),size:g(k).MEDIUM},{body:$(()=>[c("div",Ft,[c("div",Nt,[O(c("p",{class:z(["stats-style",g(P)("CreditStorage")])},null,2),[[s,"DAILY_INVESTMENT"]]),c("input",{value:e.$store.state.userSettings.calcDayCreditLimit,type:"number",min:"0",onInput:t[2]||(t[2]=u=>e.$store.commit(g(mt).SET_CALC_DAY_CREDIT_LIMIT,parseInt(u.target.value)))},null,40,$t)]),L(It,{"on-create-new":()=>i.value=!0,instance:g(y),"data-to-string":g(y).selectedConfig.actually},null,8,["on-create-new","instance","data-to-string"])])]),_:1},8,["open","title","size"]),L(B,{open:i.value,"onUpdate:open":t[6]||(t[6]=u=>i.value=u),title:e.$t("CREATE"),size:g(k).SMALL},{body:$(()=>[c("div",zt,[O(c("p",Gt,null,512),[[s,"FROM_TEXT_FORMAT"]]),Kt,O(c("input",{"onUpdate:modelValue":t[5]||(t[5]=u=>r.value=u)},null,512),[[vt,r.value]])]),c("div",Vt,[O(c("button",{class:"button green",onClick:et},null,512),[[s,"TID_OK"]])])]),_:1},8,["open","title","size"]),L(B,{open:a.value,"onUpdate:open":t[7]||(t[7]=u=>a.value=u),title:e.$t("TID_MORE_INFO_BTN"),size:g(k).MEDIUM},{body:$(()=>[c("div",jt,[O(c("p",null,null,512),[[s,"UPGRADE_TIME_IN_PARALLEL_INFO"]])])]),_:1},8,["open","title","size"])])}}}),xt=At(kt,[["__scopeId","data-v-7d26eb91"]]);export{xt as C};
