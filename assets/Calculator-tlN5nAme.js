var gt=Object.defineProperty;var yt=(l,i,o)=>i in l?gt(l,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[i]=o;var G=(l,i,o)=>(yt(l,typeof i!="symbol"?i+"":i,o),o);import{s as ot,A as at,aI as q,aL as Ct,d as mt,g as vt,O as _t,k as bt,j as F,a as P,aM as St,r as Et,o as L,b as R,e as K,h as B,f as d,t as D,u as I,H as It,F as U,D as j,w,C as $,B as Ot,aN as At,K as W,S as X,M as Q,L as tt,G as Tt,p as wt,i as Lt,_ as Rt}from"./index-KwuTZ_vQ.js";import{o as z,i as et,k as Dt,v as Mt}from"./Data-Rj2Vpt7F.js";import{s as V}from"./globals-zpsYnYkF.js";function Nt(l,i){const o=ot({actually:{},plan:{},total:{intermediate:{},result:{}}}),c={};for(const h of l)o.total.result[h]=0;const p=i(c,o);return{provideGetterElements:e,output:o,update:E};function e(h){return h(x,c)}function E(h,a){const r=(n,v)=>O(n,([m],_,A)=>N(Object.fromEntries(A),m,h.actually[n],v)),u=(n,v)=>O(n,([,m])=>Array.isArray(m)?m[v-1]:m);a?(C(o.plan,a,r(a,h.plan[a])),C(o.actually,a,u(a,h.actually[a]))):(S(h.plan,o.plan,r),S(h.actually,o.actually,u)),y(o.total);for(const[n,v]of Object.entries(o.plan))if(Object.keys(v).length){for(const m of l)o.total.result[m]+=v[m];p(n,h)}}function O(h,a){return(...r)=>{const[[u]]=r;if(J(c[h][u])){const v=z(c[h][u],{map:(...m)=>[m[0][0],a(...m)]});return[u,v]}const n=a(...r);return[u,n]}}function C(h,a,r){c[a]&&(h[a]=z(c[a],{map:r}))}function S(h,a,r){if(Object.keys(h).length)for(const[u,n]of Object.entries(h))n?C(a,u,r(u,n)):a[u]={};else for(const u of Object.keys(a))delete a[u]}function N(h,a,r,u){const n=h[a],v=r>0?n[r-1]:0;let m=n[u-1];if(!Array.isArray(n))return!r&&u?n:0;if(l.includes(a)){m=0;let _=r>0?r-1:0;for(;_<=u-1;)m+=n[_],_++}return m-v}function y(h){for(const a in h)if(a in h){if(J(h[a])){y(h[a]);continue}h[a]=0}}function x(h,a){const r=xt(h);return u(r),r;function u(n){for(const v in n)if(v in n){const m=n[v],_=typeof m[1]=="boolean"?m[0]:m;if(J(_)){const A=x(_,a);Object.keys(A).length?n[v]=A:delete n[v];continue}else if(!(Array.isArray(_)&&_.length==a)&&!l.includes(v)){delete n[v];continue}typeof m[1]=="boolean"&&(n[v]=_)}return n}}}function J(l){return typeof l=="object"&&!Array.isArray(l)&&l!==null}function xt(l){const i=at(),o=z(l,{map:([c,p])=>[c,[p,et(c,l.Name)]],filter:([c,[,p]])=>{var e,E;return c.startsWith("_")||et(c,null,{asMeta:!0,asTitle:!1})?!1:(E=(e=i==null?void 0:i.state)==null?void 0:e.userSettings)!=null&&E.disableFilters?!0:!p}});if(l.projectile){const{projectile:c}=o;delete o.projectile,o.projectile=c}return o}const nt={crush:(l,i=50)=>{const o="",c=(C,S)=>{let N=S.length,y="";const x=r=>encodeURI(encodeURIComponent(r)).replace(/%../g,"i").length,h=r=>{let u=r.charCodeAt(0),n=r.charCodeAt(r.length-1);return u>=56320&&u<=57343||n>=55296&&n<=56319};let a={};for(let r=2;r<i;r++)for(let u=0;u<C.length-r;++u){let n=C.substr(u,r);if(a[n]||h(n))continue;let v=1;for(let m=C.indexOf(n,u+r);m>=0;++v)m=C.indexOf(n,m+r);v>1&&(a[n]=v)}for(;;){for(;N--&&C.includes(S[N]););if(N<0)break;let r=S[N],u,n=0,v=x(r);for(let _ in a){let A=a[_],T=(A-1)*x(_)-(A+1)*v;y.length||(T-=x(o)),T<=0?delete a[_]:T>n&&(u=_,n=T)}if(!u)break;C=C.split(u).join(r)+r+u,y=r+y;let m={};for(let _ in a){let A=_.split(u).join(r),T=0;for(let M=C.indexOf(A);M>=0;++T)M=C.indexOf(A,M+A.length);T>1&&(m[A]=T)}a=m}return{a:C,b:y}};let p=[];const e="-_.!~*'()";for(let C=127;--C;)(C>=48&&C<=57||C>=65&&C<=90||C>=97&&C<=122||e.includes(String.fromCharCode(C)))&&p.push(String.fromCharCode(C));for(let C=32;C<255;++C){let S=String.fromCharCode(C);S!="\\"&&!p.includes(S)&&p.unshift(S)}l=l.replace(new RegExp(o,"g"),""),l=st(l);const E=c(l,p);let O=E.a;return E.b.length&&(O+=o+E.b),O+="_",O},uncrush:l=>{l=l.substring(0,l.length-1);const i=l.split("");let o=i[0];if(i.length>1){let c=i[1];for(let p of c){let e=o.split(p);o=e.join(e.pop())}}return st(o,0)}},st=(l,i=1)=>{const o=[['"',"'"],["':","!"],[",'","~"],["}",")","\\","\\"],["{","(","\\","\\"]],c=(p,e)=>{let E=new RegExp(`${(e[2]?e[2]:"")+e[0]}|${(e[3]?e[3]:"")+e[1]}`,"g");return p.replace(E,O=>O===e[0]?e[1]:e[0])};if(i)for(let p=0;p<o.length;++p)l=c(l,o[p]);else for(let p=o.length;p--;)l=c(l,o[p]);return l},lt="new entry",H="en";class $t{constructor(i){G(this,"store");G(this,"TIDs",{});this.localStoreKey=i,this.store=ot({configs:[],selected:0}),this.load()}get selectedConfig(){return this.store.configs[this.store.selected].value}load(){const i=JSON.parse(localStorage.getItem(this.localStoreKey)||"{}");if(i.configs){Object.assign(this.store,i);return}if(Object.keys(i).length&&i.actually&&i.plan){this.add(i);return}this.add()}save(){localStorage.setItem(this.localStoreKey,JSON.stringify(this.store))}removeSelected(){if(this.store.configs.splice(this.store.selected,1),this.store.configs.length==0){this.add();return}this.store.selected=this.store.configs.length-1}add(i,{temporary:o}={temporary:!1}){const c=this.store;let p=0,e;do e=p?`${lt} #${p}`:lt,p++;while(c.configs.length&&c.configs.some(E=>E.name==e));c.configs=[...c.configs,{name:e,value:i||{actually:{},plan:{}}}],c.selected=c.configs.length-1,o||this.save()}async parseString(i){const o=[];q.global.availableLocales.includes(H)||await Ct(H);for(const[c,p]of Object.entries(this.TIDs)){const e=q.global.t(p,H),E=new RegExp(`${e}\\s+?(\\d+)\\s?`,"mi"),[,O]=i.match(E)||[void 0,"0"];o.push([c,parseInt(O)])}return Object.fromEntries(o.filter(([,c])=>c))}stringifyUrl(){const i=JSON.stringify(this.selectedConfig.actually);return nt.crush(i)}parseUrl(i){return JSON.parse(nt.uncrush(i))}}const Ft=l=>(wt("data-v-0e3804ea"),l=l(),Lt(),l),Ut={class:"topic"},jt={class:"total-table"},kt={key:0,colspan:"3"},Gt={class:"buttons"},Pt={class:"reset-buttons"},Kt={class:"settings-modal"},Bt={class:"input-wrap"},Vt=["value"],Jt={class:"config-category"},Ht={class:"flex-end"},zt={class:"select"},Yt={class:"name"},Zt=["value"],qt={class:"input"},Wt={class:"name"},Xt=["placeholder"],Qt={class:"flex-end margin-bottom"},te={class:"input"},ee={class:"name"},ne=Ft(()=>d("p",{class:"name"},"Example: Fortify 8 Bond 5",-1)),se={class:"flex-end margin-bottom"},le=mt({__name:"Calculator",props:{stackChars:{},calcTotal:{},localStorageKey:{},titleKey:{},input:{}},emits:["update:input","setup"],setup(l,{emit:i}){const o=at(),{t:c}=vt(),p=_t(),e=l,E=i,O={key:s=>Dt(s,p.currentRoute.value.name),value:(s,t)=>Mt(s,t,p.currentRoute.value.name)},{provideGetterElements:C,output:S,update:N}=Nt(e.stackChars,e.calcTotal),y=new $t(e.localStorageKey),x=bt(()=>{A(),T(),y.save()},100),h={output:S,onChangeLvl:k,isSelected:ft,isDisabled:dt,outputClasses:pt,forceReCalc:M,format:O,provideGetterElements:s=>C((...t)=>s(y.TIDs,...t))},a=F(!1),r=F(!1),u=F(""),n=F({text:c("COPY"),color:"yellow"}),v=P(()=>c(e.titleKey)),m=P(()=>Object.keys(S.total.result)),_=P(()=>`${location.origin}${location.pathname}`);if(p.currentRoute.value.query.d){const s=y.parseUrl(p.currentRoute.value.query.d),t={actually:{...s},plan:{...s}};y.add(t,{temporary:!0})}M(),E("setup",h);function A(){E("update:input",y.selectedConfig)}function T(s){St(()=>N(e.input,s))}function M(){A(),T()}async function Y(s){if(s.target.name=="all")await o.dispatch(tt.OPEN_CONFIRM,"Reset all ? Are you serious ?").then(()=>{for(const t in e.input)t in e.input&&(y.selectedConfig[t]={})}).catch(()=>{});else if(e.input.plan)for(const t in e.input.plan)t in e.input.plan&&(y.selectedConfig.plan[t]=e.input.actually[t]);T(),y.save()}async function rt(){const{name:s}=y.store.configs[y.store.selected];await o.dispatch(tt.OPEN_CONFIRM,c("REMOVE_CONFIG",[s])).then(()=>{y.removeSelected(),M()}).catch(()=>{})}async function it(){let s={};u.value&&await y.parseString(u.value).then(t=>s=t).catch(t=>{alert(t.message),console.error(t)}),y.add({actually:{...s},plan:{...s}}),u.value="",r.value=!1,M()}function ct(){const s=y.stringifyUrl();navigator.clipboard.writeText(`${_.value}?d=${s}`).then(()=>{n.value={text:c("COPIED"),color:"green"},setTimeout(()=>n.value={text:c("COPY"),color:"yellow"},2e3)}).catch(t=>{n.value={text:c("Error"),color:"red"},alert(t.message),console.error(t)})}function ut(s,t){const f=S.total.intermediate[t];if(s=="plan")return{"yellow-color plus":f.plan,hide:f.plan==0};if(s=="sum"){const g=f.sum>f.actually;return{"green-color ":g,muffle:!g,hide:f.sum==0}}return{}}function k(s,t,f){f=typeof f=="string"?parseInt(f):f,f==0?(delete e.input[s][t],delete S[s][t]):y.selectedConfig[s][t]=f;const g=e.input.plan[t]||0,b=e.input.actually[t];return b>g&&k("plan",t,b),x(),f}function ft(s,t,f){let g=e.input.plan[t]||0;const b=e.input.actually[t];return b>g&&(g=k("plan",t,b)),s=="plan"?f==g:e.input[s][t]==f}function dt(s,t,f){return s!="plan"||!e.input.actually?!1:f<e.input.actually[t]}function pt(s,t,f){if(s=="actually")return{none:f&&m.value.includes(f),actually:!0};if(s=="plan"){const g=f?S[s][t][f]:void 0;return{"yellow-color":(e.input.actually[t]?e.input.plan[t]>e.input.actually[t]:!0)&&typeof g!="object",plus:!f||f&&!m.value.includes(f),none:e.input.plan[t]==e.input.actually[t],plan:!0}}return{}}return(s,t)=>{const f=Et("t");return L(),R("div",null,[K(I(It),null,{default:B(()=>[d("title",null,D(v.value),1)]),_:1}),d("h1",Ut,D(v.value),1),d("table",jt,[(L(!0),R(U,null,j(I(S).total.intermediate,(g,b)=>(L(),R("tr",{key:b},[d("td",{class:$([I(V)(b),"stats-style"])},D(O.key(b)),3),(L(!0),R(U,null,j(g,(ht,Z)=>(L(),R("td",{key:b+Z,class:$(ut(Z,b))},D(ht.toLocaleString("ru-RU")),3))),128))]))),128)),(L(!0),R(U,null,j(I(S).total.result,(g,b)=>(L(),R("tr",{key:b,class:"result"},[d("td",{class:$([I(V)(b),"stats-style"])},D(O.key(b)),3),g>0?(L(),R("td",kt,[d("b",null,D(O.value(b,g)),1)])):Tt("",!0)]))),128))]),d("div",Gt,[d("button",{class:"settings",onClick:t[0]||(t[0]=g=>a.value=!0)}),d("div",Pt,[d("button",{class:"button yellow",name:"plan",onClick:Y},D(s.$t("RESET_PLAN")),1),d("button",{class:"button red",name:"all",onClick:Y},D(s.$t("RESET_ALL")),1)])]),K(Q,{open:a.value,"onUpdate:open":[t[6]||(t[6]=g=>a.value=g),t[7]||(t[7]=()=>I(y).save())],title:s.$t("CALCULATOR_SETTINGS"),size:I(X).MEDIUM},{body:B(()=>[d("div",Kt,[d("div",Bt,[w(d("p",{class:$(["stats-style",I(V)("CreditStorage")])},null,2),[[f,"TID_PLANET_UPG_CREDIT_YIELD"]]),d("input",{value:s.$store.state.userSettings.calcDayCreditLimit,type:"number",min:"0",onInput:t[1]||(t[1]=g=>s.$store.commit(I(Ot).SET_CALC_DAY_CREDIT_LIMIT,parseInt(g.target.value)))},null,40,Vt)]),d("div",Jt,[w(d("p",null,null,512),[[f,"CONFIG"]]),d("div",Ht,[d("button",{class:$(`button ${n.value.color}`),onClick:ct},D(n.value.text),3),w(d("button",{class:"button green",onClick:t[2]||(t[2]=g=>r.value=!0)},null,512),[[f,"CREATE"]])])]),d("div",zt,[w(d("p",Yt,null,512),[[f,"LIST"]]),w(d("select",{"onUpdate:modelValue":t[3]||(t[3]=g=>I(y).store.selected=g),onChange:t[4]||(t[4]=g=>M())},[(L(!0),R(U,null,j(I(y).store.configs,(g,b)=>(L(),R("option",{key:b,value:b},D(g.name),9,Zt))),128))],544),[[At,I(y).store.selected]])]),d("div",qt,[w(d("p",Wt,null,512),[[f,"TID_CHANGE_NAME_TITLE"]]),w(d("input",{"onUpdate:modelValue":t[5]||(t[5]=g=>I(y).store.configs[I(y).store.selected].name=g),placeholder:s.$t("TID_CORP_NAME_LABEL")},null,8,Xt),[[W,I(y).store.configs[I(y).store.selected].name]])]),d("div",Qt,[w(d("button",{class:"button red",onClick:rt},null,512),[[f,"TID_SOCIAL_DELETE_MESSAGE"]])])])]),_:1},8,["open","title","size"]),K(Q,{open:r.value,"onUpdate:open":t[9]||(t[9]=g=>r.value=g),title:s.$t("CREATE"),size:I(X).SMALL},{body:B(()=>[d("div",te,[w(d("p",ee,null,512),[[f,"FROM_TEXT_FORMAT"]]),ne,w(d("input",{"onUpdate:modelValue":t[8]||(t[8]=g=>u.value=g)},null,512),[[W,u.value]])]),d("div",se,[w(d("button",{class:"button green",onClick:it},null,512),[[f,"TID_OK"]])])]),_:1},8,["open","title","size"])])}}}),ce=Rt(le,[["__scopeId","data-v-0e3804ea"]]);export{ce as C};
