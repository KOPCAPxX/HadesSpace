import{d as le,g as se,A as oe,l as H,m as ne,S as re,a as ie,B as x,r as ce,o as d,b as p,f as n,e as k,w as j,u as A,h as q,F as C,D as P,t as D,v as ue,M as de,s as pe,C as X,p as me,i as _e,aI as fe,_ as ve}from"./index-_3hBK0XR.js";import{l as Z,Y as F}from"./planet_levels-OgGYPt_4.js";import{o as U,p as Se,V as he}from"./Data-jvDJbZdk.js";import{s as Ce}from"./spacebuildings-NmTc9Pj4.js";import{g as ge}from"./globals-zpsYnYkF.js";import{C as Te}from"./Calculator-hGhPKPI8.js";import{N as Le}from"./NumberPicker-ZQzExdFT.js";import{g as ye}from"./getFilterByType-aSftiFBn.js";import"./sec2str-sZXMg2Jz.js";import"./TheConfirm-ef0VKfjz.js";import"./byTypes-1BYQ2hUk.js";function Ae(g){return g[0].map((B,R)=>g.map(M=>M[R]))}const E=g=>(me("data-v-554ab77f"),g=g(),_e(),g),Pe={class:"wrap"},Re={class:"container"},Ie={class:"switch"},be={class:"name"},De=E(()=>n("p",null,null,-1)),Ee=["checked"],Me=E(()=>n("label",{for:"compact-mode",class:"label"},null,-1)),Ne=E(()=>n("th",null,null,-1)),ke=["onChange"],Ue=["selected"],Ve=E(()=>n("td",null,null,-1)),Oe={class:"number-picker"},He=["onClick"],xe=E(()=>n("img",{src:fe,class:"open-info",alt:"info icon"},null,-1)),je=[xe],qe={class:"modal-module"},Fe={class:"chars"},Be={class:"output"},$e=le({__name:"PlanetsCalc",setup(g){const{SP2ShipmentsBoostPct:B}=ge,R={CreditStorage:"CreditStorageModifier",FuelStorage:"FuelStorageModifier",CreditsPerHour:"CreditIncomeModifier",FuelPerHour:"FuelIncomeModifier",ShipmentsCRValuePerDay:"CreditShipmentModifier"},M={TotalShipmentCRPerDay:"ShipmentsCRValuePerDay",Cost:"Cost",ConstructionTime:"TimeToUpgrade"},$=["XPAward","Cost","TimeToUpgrade","TimeToUpgradeParallel","RSLevelReq"],K=["CrystalsWeight","Name"],Y=Object.keys(Z).filter(t=>![...$,...K].includes(t)),w=Object.values(F.NumMoons).reduce((t,a,i)=>(a&&(Array.isArray(a)?a.forEach((e,s)=>t[F.PlanetTypes[i][s]]=e):t[F.PlanetTypes[i]]=a),t),{}),{t:J}=se(),V=oe(),W=H([]),f=H({actually:{},plan:{}}),O=H(!1),T=ne({size:re.SMALL,title:"name",data:{planet:{},get key(){return this.planet.Name}}}),v=ie(()=>Object.values(W.value));let m;V.subscribe(t=>{t.type==x.SWITCH_PLANETS_CALC_SP2&&m&&(z(m),m.forceReCalc()),t.type==x.SET_CALC_DAY_CREDIT_LIMIT&&m.forceReCalc()});function z(t){m=t,W.value=t.provideGetterElements(ae)}function Q(t){T.title=J(t.TID),T.data.planet=t,O.value=!0}function G(t,a){return m.outputClasses(t,T.data.key,a)}function ee(t,a){v.value.forEach(async({Name:i})=>{i.startsWith("TradingStation")||m.onChangeLvl(t,i,parseInt(a))})}function te(t,a){let i=0;const e={};for(const s of Y)a.total.intermediate[s]={actually:0,plan:0,sum:0};return pe(()=>a.total.result.TimeToUpgrade,()=>{i=0}),function(s,o){var r,h;const u=V.state.userSettings.calcDayCreditLimit/24;let l=0;for(const c of Y)a.total.intermediate[c].actually+=((r=a.actually[s])==null?void 0:r[c])||0,a.total.intermediate[c].plan+=((h=a.plan[s])==null?void 0:h[c])||0,a.total.intermediate[c].sum=a.total.intermediate[c].actually+a.total.intermediate[c].plan;if(t[s].RSLevelReq){const c=t[s].RSLevelReq[o.plan[s]-1]||0;i=a.total.result.RSLevelReq=i<c?c:i}if(t[s].TimeToUpgrade){const c=t[s],I=o.actually[s],N=o.plan[s],_=[];for(let S=0;S<N-I;S++){const L=I+S,b=c.TimeToUpgrade[L]/3600;for(let y=0;y<b;y++)_.push(c.Cost[L]/(c.TimeToUpgrade[L]/3600))}_.length?e[s]=_:delete e[s],Object.keys(e).length&&(Ae(Object.values(e)).forEach(S=>{const L=S.reduce((b,y)=>b+y||0,0);l+=Math.ceil(L/u)}),a.total.result.TimeToUpgradeParallel=l*3600)}}}function ae(...[t,a,i]){let e=0;const s=U(Z,{filter:([,l])=>Array.isArray(l)}),o=U(Se,{...ye("planets.yellowstar"),map:([l,r])=>(i[l]=U(s,{map:([h,c])=>{const I=r.MaxUpgradeLevel,N=V.state.userSettings.planetsCalcSp2&&h=="ShipmentsCRValuePerDay"?B/100:0;let _=c.map(S=>S*(h in R?r[R[h]]/100:1+N));return h=="ShipmentsCRValuePerDay"&&(_=c.map(S=>{const L=r[R.ShipmentsCRValuePerDay]/100,b=r.Name in w?w[r.Name]:0,y=S*L*(b+1);return y+y*N})),_.length<I&&_.push(...Array.from({length:I-_.length},()=>_[_.length-1])),[h,_]}}),t[l]=r.TID,[l,r])}),u=U(Ce.TradingStation,{map:([l,r])=>(Array.isArray(r)&&r.length>e&&(e=r.length),[l in M?M[l]:l,r])});u.MaxUpgradeLevel=e;for(let l=0;u.MaxOnOwnSolarSystem>l;l++){const r={...u,Name:`${u.Name}_${l}`};o[r.Name]=r,i[r.Name]=a(r,e)}return o}return(t,a)=>{const i=ce("t");return d(),p("div",Pe,[n("div",Re,[k(Te,{input:f.value,"onUpdate:input":a[0]||(a[0]=e=>f.value=e),"stack-chars":$,"calc-total":te,"local-storage-key":"planetsCalc","title-key":"PLANETS_CALC",onSetup:z},null,8,["input"]),n("div",Ie,[n("div",null,[j(n("p",be,null,512),[[i,"TID_STARTER_PACK_2"]]),De]),n("input",{id:"compact-mode",class:"checkbox",type:"checkbox",checked:t.$store.state.userSettings.planetsCalcSp2,onChange:a[1]||(a[1]=e=>t.$store.commit(A(x).SWITCH_PLANETS_CALC_SP2))},null,40,Ee),Me]),k(he,{data:{TID:"INPUT_VALUES",Name:"Input",TID2:["",...v.value.map(e=>e.TID)]},"table-opts":{lvlColKey:"â„–",mergeCells:!1,colLvlStartAt:0}},{"table-head":q(()=>[j(n("th",null,null,512),[[i,"CURRENT_LVL"]]),j(n("th",null,null,512),[[i,"PLAN_LVL"]]),Ne]),"table-body":q(({row:e})=>[e==0?(d(),p(C,{key:0},[(d(!0),p(C,null,P(f.value,(s,o)=>(d(),p("td",{key:o},[n("select",{class:"select",onChange:u=>ee(o,u.target.value)},[(d(!0),p(C,null,P(v.value[e].MaxUpgradeLevel+1,(u,l)=>(d(),p("option",{key:o+u,selected:A(m).isSelected(o,v.value[e].Name,l)},D(l),9,Ue))),128))],40,ke)]))),128)),Ve],64)):(d(),p(C,{key:1},[(d(!0),p(C,null,P(f.value,(s,o)=>{var u,l;return d(),p("td",{key:o},[n("div",Oe,[k(Le,{value:((u=f.value[o])==null?void 0:u[v.value[e-1].Name])||0,min:(o=="plan"?(l=f.value.actually)==null?void 0:l[v.value[e-1].Name]:0)||0,max:v.value[e-1].MaxUpgradeLevel,"onUpdate:value":r=>A(m).onChangeLvl(o,v.value[e-1].Name,r)},null,8,["value","min","max","onUpdate:value"])])])}),128)),n("td",null,[n("div",{onClick:()=>Q(v.value[e-1])},je,8,He)])],64))]),_:1},8,["data"])]),k(de,ue({open:O.value,"onUpdate:open":a[2]||(a[2]=e=>O.value=e)},T),{body:q(()=>[n("div",qe,[n("ul",Fe,[n("li",Be,[n("b",null,D(t.$t("TID_PLANET_LEVEL_DESCR")),1),n("div",null,[(d(!0),p(C,null,P(f.value,(e,s)=>{var o;return d(),p("span",{key:s,class:X(G(s,null))},D((o=f.value[s])==null?void 0:o[T.data.key]),3)}),128))])]),(d(!0),p(C,null,P(Object.keys(A(m).output.plan[T.data.key]||{}).filter(e=>!K.includes(e)),e=>(d(),p("li",{key:e,class:"calc.output"},[n("b",null,D(A(m).format.key(e)),1),n("div",null,[(d(!0),p(C,null,P(f.value,(s,o)=>{var u,l;return d(),p("span",{key:o,class:X(G(o,e))},D(A(m).format.value(e,Math.trunc((l=(u=A(m).output[o])==null?void 0:u[T.data.key])==null?void 0:l[e])||void 0)),3)}),128))])]))),128))])])]),_:1},16,["open"])])}}}),tt=ve($e,[["__scopeId","data-v-554ab77f"]]);export{tt as default};
