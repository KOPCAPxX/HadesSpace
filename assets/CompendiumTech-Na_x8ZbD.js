import{j as y,k as w,l as u,m as H,n as q,q as z,d as F,g as G,s as K,S as X,v as Y,r as Z,o as J,c as Q,h as T,e as p,f as s,t as L,u as _,H as W,w as ee,x as te,M as ae,y as B,z as M,I as A,p as ne,i as se,_ as le}from"./index-KwuTZ_vQ.js";import{o as oe}from"./Data-Rj2Vpt7F.js";import{T as ie,C as ce}from"./CompendiumTechList--YfzYDaI.js";import{N as re}from"./NumberPicker-2rsSHcPX.js";import{g as ue}from"./globals-zpsYnYkF.js";import{s as S}from"./capital_ships-ioQeNDqF.js";import{a as de}from"./alliance_levels-o1qIIhIq.js";import{s as D}from"./spacebuildings-NmTc9Pj4.js";import{m as N}from"./ModulePage.vue_vue_type_script_setup_true_lang-kwY-Mz53.js";import"./sec2str-coxus2Nb.js";import"./byTypes-1BYQ2hUk.js";import"./Page-e2hypn7p.js";function me(){const n=y(null),d=y({}),v=w((l,m)=>u.setTechLevel(l,m),500);return H(()=>{u.getUser()&&(n.value=u.getTechLevels())}),q(n,l=>{l&&(d.value=oe(l,{map:([m,I])=>[z(m),I.level]}))},{deep:!0}),u.on("sync",l=>n.value=l),u.on("connected",()=>n.value=u.getTechLevels()),u.on("disconnected",()=>{n.value=void 0,d.value=void 0}),{data:n,levelMap:d,setTechLevel:v}}const pe=n=>(ne("data-v-6bc4481e"),n=n(),se(),n),ve={class:"container"},fe={class:"modal"},he={class:"title"},_e=pe(()=>s("div",null,null,-1)),Ie={class:"level-picker"},ge=F({__name:"CompendiumTech",setup(n){const d={RedStarScanner:D.RedStarScanner,ShipmentRelay:D.ShipmentRelay},v={Transport:S.Transport,Miner:S.Miner,Battleship:S.Battleship},{MaxModuleLevel:l}=ue,m=Object.fromEntries([...Object.entries(d).map(([e,t])=>[e,t.Cost.length]),...Object.entries(v).map(([e,t])=>[e,t.BuildCost.length]),...Object.keys(N).map(e=>[e,l]),["AllianceLevel",de.XPRequired.length]]),I=Object.fromEntries([...Object.keys(d).map(e=>[e,0]),...Object.keys(v).map(e=>[e,0]),...Object.entries(N).map(([e,t])=>[e,$(t)]),["AllianceLevel",0]]),{data:i,levelMap:x,setTechLevel:C}=me(),{t:c}=G(),E=c("HS_COMPENDIUM"),f=y(!1),a=K({size:X.SMALL,title:c("TECHNOLOGIES"),data:{value:{},maxLevel:0,minLevel:0,lastAgoUpdate:0,get key(){return this.value.Name}}}),k=setInterval(g,5e3);Y(()=>{clearTimeout(k)});function j(e){i.value&&(a.data.value=e,a.data.maxLevel=m[e.Name],a.data.minLevel=I[e.Name],f.value=!0,g())}function R(e){var t;return!((t=h(e))!=null&&t.level)}function U(e){const t=B(a.data.key);return i.value[t]||(i.value[t]={level:0}),a.data.minLevel!=0&&e==a.data.minLevel&&i.value[t].level!=0&&(e=0),i.value[t].level!=e&&(i.value[t].level=e,C(t,e),g()),e}function $(e){let t=1;for(const[,o]of Object.entries(e))Array.isArray(o)&&o.length>t&&(t=o.length);return l-t+1}function h(e){var t;return((t=i.value)==null?void 0:t[B(e)])||null}function P(){var t;const e=a.data.value;if(e.Icon)return M(A,{name:e.Icon,dir:e.specialIcon?"icons":"game/Modules"});if(e.Model)return M(A,{name:e.Model[((t=h(e.Name))==null?void 0:t.level)-1||5],dir:"game/Ships"});if(e.PrefabModel)return M(A,{name:e.PrefabModel,dir:"game/SpaceBuildings"})}function g(){var e;if(f.value){const t=(e=h(a.data.key))==null?void 0:e.ts;t&&(a.data.lastAgoUpdate=(new Date().getTime()-t)/1e3)}}function V(e){const t=[],o=Math.trunc(e/86400),r=Math.trunc(e%86400/3600),O=Math.trunc(e%3600/60),b=Math.trunc(e%60);return o!=0&&t.push(`${o}${c("TID_DAY_ABBREVIATION")}`),r!=0&&t.push(`${r}${c("TID_HOUR_ABBREVIATION")}`),O!=0&&t.push(`${O}${c("TID_MINUTE_ABBREVIATION")}`),b!=0&&t.push(`${b}${c("TID_SECOND_ABBREVIATION")}`),t.slice(0,2).join(" ")}return(e,t)=>{const o=Z("t");return J(),Q(ce,null,{default:T(()=>[p(_(W),null,{default:T(()=>[s("title",null,L(_(E)),1)]),_:1}),s("div",null,[s("div",ve,[p(ie,{"on-click":j,"is-muted":R,"level-map":_(x)},null,8,["level-map"])]),p(ae,te({open:f.value,"onUpdate:open":t[0]||(t[0]=r=>f.value=r)},a),{body:T(()=>{var r;return[s("div",fe,[s("div",he,[s("div",null,[s("h2",null,L(e.$t(a.data.value.TID)),1),s("p",null,L(_(c)("TID_SOCIAL_TIMESTAMP",[V(a.data.lastAgoUpdate)])),1),_e]),p(P)]),ee(s("span",null,null,512),[[o,"CURRENT_LVL"]]),s("div",Ie,[p(re,{value:((r=h(a.data.key))==null?void 0:r.level)||0,min:a.data.minLevel,max:a.data.maxLevel,"onUpdate:value":U},null,8,["value","min","max"])])])]}),_:1},16,["open"])])]),_:1})}}}),Ce=le(ge,[["__scopeId","data-v-6bc4481e"]]);export{Ce as default};
