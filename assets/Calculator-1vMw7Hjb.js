var gt=Object.defineProperty;var yt=(l,i,o)=>i in l?gt(l,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[i]=o;var G=(l,i,o)=>(yt(l,typeof i!="symbol"?i+"":i,o),o);import{j as ot,s as at,aH as Z,aL as Ct,d as mt,g as vt,N as bt,aK as _t,i as F,a as P,aM as St,r as Et,o as R,b as L,e as K,h as B,f as d,t as D,u as I,H as It,F as U,B as j,w,A as $,x as Ot,aN as At,J as W,S as X,M as Q,K as tt,E as Tt,p as wt,q as Rt,_ as Lt}from"./index-EzisDGea.js";import{o as z,i as et,k as Dt,v as Mt}from"./Data-jhsRB_HB.js";import{s as V}from"./globals-zpsYnYkF.js";function Nt(l,i){const o=ot({actually:{},plan:{},total:{intermediate:{},result:{}}}),c={};for(const g of l)o.total.result[g]=0;const p=i(c,o);return{provideGetterElements:e,output:o,update:E};function e(g){return g(x,c)}function E(g,a){const r=(n,v)=>O(n,([m],b,A)=>N(Object.fromEntries(A),m,g.actually[n],v)),u=(n,v)=>O(n,([,m])=>Array.isArray(m)?m[v-1]:m);a?(C(o.plan,a,r(a,g.plan[a])),C(o.actually,a,u(a,g.actually[a]))):(S(g.plan,o.plan,r),S(g.actually,o.actually,u)),h(o.total);for(const[n,v]of Object.entries(o.plan))if(Object.keys(v).length){for(const m of l)o.total.result[m]+=v[m];p(n,g)}}function O(g,a){return(...r)=>{const[[u]]=r;if(J(c[g][u])){const v=z(c[g][u],{map:(...m)=>[m[0][0],a(...m)]});return[u,v]}const n=a(...r);return[u,n]}}function C(g,a,r){c[a]&&(g[a]=z(c[a],{map:r}))}function S(g,a,r){if(Object.keys(g).length)for(const[u,n]of Object.entries(g))n?C(a,u,r(u,n)):a[u]={};else for(const u of Object.keys(a))delete a[u]}function N(g,a,r,u){const n=g[a],v=r>0?n[r-1]:0;let m=n[u-1];if(!Array.isArray(n))return!r&&u?n:0;if(l.includes(a)){m=0;let b=r>0?r-1:0;for(;b<=u-1;)m+=n[b],b++}return m-v}function h(g){for(const a in g)if(a in g){if(J(g[a])){h(g[a]);continue}g[a]=0}}function x(g,a){const r=xt(g);return u(r),r;function u(n){for(const v in n)if(v in n){const m=n[v],b=typeof m[1]=="boolean"?m[0]:m;if(J(b)){const A=x(b,a);Object.keys(A).length?n[v]=A:delete n[v];continue}else if(!(Array.isArray(b)&&b.length==a)&&!l.includes(v)){delete n[v];continue}typeof m[1]=="boolean"&&(n[v]=b)}return n}}}function J(l){return typeof l=="object"&&!Array.isArray(l)&&l!==null}function xt(l){const i=at(),o=z(l,{map:([c,p])=>[c,[p,et(c,l.Name)]],filter:([c,[,p]])=>{var e,E;return c.startsWith("_")||et(c,null,{asMeta:!0,asTitle:!1})?!1:(E=(e=i==null?void 0:i.state)==null?void 0:e.userSettings)!=null&&E.disableFilters?!0:!p}});if(l.projectile){const{projectile:c}=o;delete o.projectile,o.projectile=c}return o}const nt={crush:(l,i=50)=>{const o="",c=(C,S)=>{let N=S.length,h="";const x=r=>encodeURI(encodeURIComponent(r)).replace(/%../g,"i").length,g=r=>{let u=r.charCodeAt(0),n=r.charCodeAt(r.length-1);return u>=56320&&u<=57343||n>=55296&&n<=56319};let a={};for(let r=2;r<i;r++)for(let u=0;u<C.length-r;++u){let n=C.substr(u,r);if(a[n]||g(n))continue;let v=1;for(let m=C.indexOf(n,u+r);m>=0;++v)m=C.indexOf(n,m+r);v>1&&(a[n]=v)}for(;;){for(;N--&&C.includes(S[N]););if(N<0)break;let r=S[N],u,n=0,v=x(r);for(let b in a){let A=a[b],T=(A-1)*x(b)-(A+1)*v;h.length||(T-=x(o)),T<=0?delete a[b]:T>n&&(u=b,n=T)}if(!u)break;C=C.split(u).join(r)+r+u,h=r+h;let m={};for(let b in a){let A=b.split(u).join(r),T=0;for(let M=C.indexOf(A);M>=0;++T)M=C.indexOf(A,M+A.length);T>1&&(m[A]=T)}a=m}return{a:C,b:h}};let p=[];const e="-_.!~*'()";for(let C=127;--C;)(C>=48&&C<=57||C>=65&&C<=90||C>=97&&C<=122||e.includes(String.fromCharCode(C)))&&p.push(String.fromCharCode(C));for(let C=32;C<255;++C){let S=String.fromCharCode(C);S!="\\"&&!p.includes(S)&&p.unshift(S)}l=l.replace(new RegExp(o,"g"),""),l=st(l);const E=c(l,p);let O=E.a;return E.b.length&&(O+=o+E.b),O+="_",O},uncrush:l=>{l=l.substring(0,l.length-1);const i=l.split("");let o=i[0];if(i.length>1){let c=i[1];for(let p of c){let e=o.split(p);o=e.join(e.pop())}}return st(o,0)}},st=(l,i=1)=>{const o=[['"',"'"],["':","!"],[",'","~"],["}",")","\\","\\"],["{","(","\\","\\"]],c=(p,e)=>{let E=new RegExp(`${(e[2]?e[2]:"")+e[0]}|${(e[3]?e[3]:"")+e[1]}`,"g");return p.replace(E,O=>O===e[0]?e[1]:e[0])};if(i)for(let p=0;p<o.length;++p)l=c(l,o[p]);else for(let p=o.length;p--;)l=c(l,o[p]);return l},lt="default entry",H="en";class $t{constructor(i){G(this,"store");G(this,"TIDs",{});this.localStoreKey=i,this.store=ot({configs:[],selected:0}),this.load()}get selectedConfig(){return this.store.configs[this.store.selected].value}load(){const i=JSON.parse(localStorage.getItem(this.localStoreKey)||"{}");if(i.configs){Object.assign(this.store,i);return}if(Object.keys(i).length&&i.actually&&i.plan){this.add(i);return}this.add()}save(){localStorage.setItem(this.localStoreKey,JSON.stringify(this.store))}removeSelected(){if(this.store.configs.splice(this.store.selected,1),this.store.configs.length==0){this.add();return}this.store.selected=this.store.configs.length-1}add(i,{temporary:o}={temporary:!1}){const c=this.store;let p=0,e;do e=p?`${lt} #${p}`:lt,p++;while(c.configs.length&&c.configs.some(E=>E.name==e));c.configs=[...c.configs,{name:e,value:i||{actually:{},plan:{}}}],c.selected=c.configs.length-1,o||this.save()}async parseString(i){const o=[];Z.global.availableLocales.includes(H)||await Ct(H);for(const[c,p]of Object.entries(this.TIDs)){const e=Z.global.t(p,H),E=new RegExp(`${e}\\s+?(\\d+)\\s?`,"mi"),[,O]=i.match(E)||[void 0,"0"];o.push([c,parseInt(O)])}return Object.fromEntries(o.filter(([,c])=>c))}stringifyUrl(){const i=JSON.stringify(this.selectedConfig.actually);return nt.crush(i)}parseUrl(i){return JSON.parse(nt.uncrush(i))}}const Ft=l=>(wt("data-v-e0fe0cfb"),l=l(),Rt(),l),Ut={class:"topic"},jt={class:"total-table"},kt={key:0,colspan:"3"},Gt={class:"buttons"},Pt={class:"reset-buttons"},Kt={class:"settings-modal"},Bt={class:"input-wrap"},Vt=["value"],Jt={class:"config-category"},Ht={class:"flex-end"},zt={class:"select"},Yt={class:"name"},qt=["value"],Zt={class:"input"},Wt={class:"name"},Xt=["placeholder"],Qt={class:"flex-end margin-bottom"},te={class:"input"},ee={class:"name"},ne=Ft(()=>d("p",{class:"name"},"Example: Fortify 8 Bond 5",-1)),se={class:"flex-end margin-bottom"},le=mt({__name:"Calculator",props:{stackChars:{},calcTotal:{},localStorageKey:{},titleKey:{},input:{}},emits:["update:input","setup"],setup(l,{emit:i}){const o=at(),{t:c}=vt(),p=bt(),e=l,E=i,O={key:s=>Dt(s,p.currentRoute.value.name),value:(s,t)=>Mt(s,t,p.currentRoute.value.name)},{provideGetterElements:C,output:S,update:N}=Nt(e.stackChars,e.calcTotal),h=new $t(e.localStorageKey),x=_t(()=>{A(),T(),h.save()},100),g={output:S,onChangeLvl:k,isSelected:ft,isDisabled:dt,outputClasses:pt,forceReCalc:M,format:O,Config:h.store,provideGetterElements:s=>C((...t)=>s(h.TIDs,...t))},a=F(!1),r=F(!1),u=F(""),n=F({text:c("COPY"),color:"yellow"}),v=P(()=>c(e.titleKey)),m=P(()=>Object.keys(S.total.result)),b=P(()=>`${location.origin}${location.pathname}`);if(p.currentRoute.value.query.d){const s=h.parseUrl(p.currentRoute.value.query.d),t={actually:{...s},plan:{...s}};h.add(t,{temporary:!0})}M(),E("setup",g);function A(){E("update:input",h.selectedConfig)}function T(s){St(()=>N(e.input,s))}function M(){A(),T()}async function Y(s){if(s.target.name=="all")await o.dispatch(tt.OPEN_CONFIRM,"Reset all ? Are you serious ?").then(()=>{for(const t in e.input)t in e.input&&(h.selectedConfig[t]={})}).catch(()=>{});else if(e.input.plan)for(const t in e.input.plan)t in e.input.plan&&(h.selectedConfig.plan[t]=e.input.actually[t]);T(),h.save()}async function rt(){const{name:s}=h.store.configs[h.store.selected];await o.dispatch(tt.OPEN_CONFIRM,c("REMOVE_CONFIG",[s])).then(()=>{h.removeSelected(),M()}).catch(()=>{})}async function it(){let s={};u.value&&await h.parseString(u.value).then(t=>s=t).catch(t=>{alert(t.message),console.error(t)}),h.add({actually:{...s},plan:{...s}}),u.value="",r.value=!1,M()}function ct(){const s=h.stringifyUrl();navigator.clipboard.writeText(`${b.value}?d=${s}`).then(()=>{n.value={text:c("COPIED"),color:"green"},setTimeout(()=>n.value={text:c("COPY"),color:"yellow"},2e3)}).catch(t=>{n.value={text:c("Error"),color:"red"},alert(t.message),console.error(t)})}function ut(s,t){const f=S.total.intermediate[t];if(s=="plan")return{"yellow-color plus":f.plan,hide:f.plan==0};if(s=="sum"){const y=f.sum>f.actually;return{"green-color ":y,muffle:!y,hide:f.sum==0}}return{}}function k(s,t,f){f=typeof f=="string"?parseInt(f):f,f==0?(delete e.input[s][t],delete S[s][t]):h.selectedConfig[s][t]=f;const y=e.input.plan[t]||0,_=e.input.actually[t];return _>y&&k("plan",t,_),x(),f}function ft(s,t,f){let y=e.input.plan[t]||0;const _=e.input.actually[t];return _>y&&(y=k("plan",t,_)),s=="plan"?f==y:e.input[s][t]==f}function dt(s,t,f){return s!="plan"||!e.input.actually?!1:f<e.input.actually[t]}function pt(s,t,f){if(s=="actually")return{none:f&&m.value.includes(f),actually:!0};if(s=="plan"){const y=f?S[s][t][f]:void 0;return{"yellow-color":(e.input.actually[t]?e.input.plan[t]>e.input.actually[t]:!0)&&typeof y!="object",plus:!f||f&&!m.value.includes(f),none:e.input.plan[t]==e.input.actually[t],plan:!0}}return{}}return(s,t)=>{const f=Et("t");return R(),L("div",null,[K(I(It),null,{default:B(()=>[d("title",null,D(v.value),1)]),_:1}),d("h1",Ut,D(v.value),1),d("table",jt,[(R(!0),L(U,null,j(I(S).total.intermediate,(y,_)=>(R(),L("tr",{key:_},[d("td",{class:$([I(V)(_),"stats-style"])},D(O.key(_)),3),(R(!0),L(U,null,j(y,(ht,q)=>(R(),L("td",{key:_+q,class:$(ut(q,_))},D(ht.toLocaleString("ru-RU")),3))),128))]))),128)),(R(!0),L(U,null,j(I(S).total.result,(y,_)=>(R(),L("tr",{key:_,class:"result"},[d("td",{class:$([I(V)(_),"stats-style"])},D(O.key(_)),3),y>0?(R(),L("td",kt,[d("b",null,D(O.value(_,y)),1)])):Tt("",!0)]))),128))]),d("div",Gt,[d("button",{class:"settings",onClick:t[0]||(t[0]=y=>a.value=!0)}),d("div",Pt,[d("button",{class:"button yellow",name:"plan",onClick:Y},D(s.$t("RESET_PLAN")),1),d("button",{class:"button red",name:"all",onClick:Y},D(s.$t("RESET_ALL")),1)])]),K(Q,{open:a.value,"onUpdate:open":[t[6]||(t[6]=y=>a.value=y),t[7]||(t[7]=()=>I(h).save())],title:s.$t("CALCULATOR_SETTINGS"),size:I(X).MEDIUM},{body:B(()=>[d("div",Kt,[d("div",Bt,[w(d("p",{class:$(["stats-style",I(V)("CreditStorage")])},null,2),[[f,"TID_PLANET_UPG_CREDIT_YIELD"]]),d("input",{value:s.$store.state.userSettings.calcDayCreditLimit,type:"number",min:"0",onInput:t[1]||(t[1]=y=>s.$store.commit(I(Ot).SET_CALC_DAY_CREDIT_LIMIT,parseInt(y.target.value)))},null,40,Vt)]),d("div",Jt,[w(d("p",null,null,512),[[f,"CONFIG"]]),d("div",Ht,[d("button",{class:$(`button ${n.value.color}`),onClick:ct},D(n.value.text),3),w(d("button",{class:"button green",onClick:t[2]||(t[2]=y=>r.value=!0)},null,512),[[f,"CREATE"]])])]),d("div",zt,[w(d("p",Yt,null,512),[[f,"LIST"]]),w(d("select",{"onUpdate:modelValue":t[3]||(t[3]=y=>I(h).store.selected=y),onChange:t[4]||(t[4]=y=>M())},[(R(!0),L(U,null,j(I(h).store.configs,(y,_)=>(R(),L("option",{key:_,value:_},D(y.name),9,qt))),128))],544),[[At,I(h).store.selected]])]),d("div",Zt,[w(d("p",Wt,null,512),[[f,"TID_CHANGE_NAME_TITLE"]]),w(d("input",{"onUpdate:modelValue":t[5]||(t[5]=y=>I(h).store.configs[I(h).store.selected].name=y),placeholder:s.$t("TID_CORP_NAME_LABEL")},null,8,Xt),[[W,I(h).store.configs[I(h).store.selected].name]])]),d("div",Qt,[w(d("button",{class:"button red",onClick:rt},null,512),[[f,"TID_SOCIAL_DELETE_MESSAGE"]])])])]),_:1},8,["open","title","size"]),K(Q,{open:r.value,"onUpdate:open":t[9]||(t[9]=y=>r.value=y),title:s.$t("CREATE"),size:I(X).SMALL},{body:B(()=>[d("div",te,[w(d("p",ee,null,512),[[f,"FROM_TEXT_FORMAT"]]),ne,w(d("input",{"onUpdate:modelValue":t[8]||(t[8]=y=>u.value=y)},null,512),[[W,u.value]])]),d("div",se,[w(d("button",{class:"button green",onClick:it},null,512),[[f,"TID_OK"]])])]),_:1},8,["open","title","size"])])}}}),ce=Lt(le,[["__scopeId","data-v-e0fe0cfb"]]);export{ce as C};
