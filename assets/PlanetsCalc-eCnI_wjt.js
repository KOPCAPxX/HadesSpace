import{d as le,s as se,g as oe,i as V,j as ne,S as re,a as ie,x as H,r as ce,o as m,b as _,f as n,e as U,w as j,u as L,h as q,F as C,B as P,t as R,m as ue,M as de,z as pe,A as X,p as me,q as _e,U as fe,_ as ve}from"./index-0jDe1gnm.js";import{l as Z,Y as F}from"./planet_levels-fKAZq_VB.js";import{o as k,p as Se,V as he}from"./Data-Ej2zYjA_.js";import{s as Ce}from"./spacebuildings-NmTc9Pj4.js";import{g as ge}from"./globals-zpsYnYkF.js";import{C as Te}from"./Calculator-cBatxzob.js";import{N as Le}from"./NumberPicker-Rc7eox06.js";import{g as ye}from"./getFilterByType-aSftiFBn.js";import"./sec2str-Pz33WdlK.js";import"./byTypes-1BYQ2hUk.js";function Ae(g){return g[0].map((B,b)=>g.map(E=>E[b]))}const I=g=>(me("data-v-814dda8c"),g=g(),_e(),g),Pe={class:"wrap"},Re={class:"container"},Ie={class:"switch"},be={class:"name"},Ee=I(()=>n("p",null,null,-1)),Me=["checked"],De=I(()=>n("label",{for:"compact-mode",class:"label"},null,-1)),Ne=I(()=>n("th",null,null,-1)),Ue=["onChange"],ke=["selected"],xe=I(()=>n("td",null,null,-1)),Oe={class:"number-picker"},Ve=["onClick"],He=I(()=>n("img",{src:fe,class:"open-info",alt:"info icon"},null,-1)),je=[He],qe={class:"modal-module"},Fe={class:"chars"},Be={class:"output"},$e=le({__name:"PlanetsCalc",setup(g){const{SP2ShipmentsBoostPct:B}=ge,b={CreditStorage:"CreditStorageModifier",FuelStorage:"FuelStorageModifier",CreditsPerHour:"CreditIncomeModifier",FuelPerHour:"FuelIncomeModifier",ShipmentsCRValuePerDay:"CreditShipmentModifier"},E={TotalShipmentCRPerDay:"ShipmentsCRValuePerDay",Cost:"Cost",ConstructionTime:"TimeToUpgrade"},$=["XPAward","Cost","TimeToUpgrade","TimeToUpgradeParallel","RSLevelReq"],K=["CrystalsWeight","Name"],Y=Object.keys(Z).filter(t=>![...$,...K].includes(t)),w=Object.values(F.NumMoons).reduce((t,a,c)=>(a&&(Array.isArray(a)?a.forEach((e,l)=>t[F.PlanetTypes[c][l]]=e):t[F.PlanetTypes[c]]=a),t),{}),x=se(),{t:J}=oe(),W=V([]),S=V({actually:{},plan:{}}),O=V(!1),T=ne({size:re.SMALL,title:"name",data:{planet:{},get key(){return this.planet.Name}}}),h=ie(()=>Object.values(W.value));let f;x.subscribe(t=>{t.type==H.SWITCH_PLANETS_CALC_SP2&&f&&(z(f),f.forceReCalc()),t.type==H.SET_CALC_DAY_CREDIT_LIMIT&&f.forceReCalc()});function z(t){f=t,W.value=t.provideGetterElements(ae)}function Q(t){T.title=J(t.TID),T.data.planet=t,O.value=!0}function G(t,a){return f.outputClasses(t,T.data.key,a)}function ee(t,a){h.value.forEach(async({Name:c})=>{c.startsWith("TradingStation")||f.onChangeLvl(t,c,parseInt(a))})}function te(t,a){let c=0;const e={};for(const l of Y)a.total.intermediate[l]={actually:0,plan:0,sum:0};return pe(()=>a.total.result.TimeToUpgrade,()=>{c=0}),function(l,s){var i,r;const u=x.state.userSettings.calcDayCreditLimit/24;let d=0;for(const o of Y)a.total.intermediate[o].actually+=((i=a.actually[l])==null?void 0:i[o])||0,a.total.intermediate[o].plan+=((r=a.plan[l])==null?void 0:r[o])||0,a.total.intermediate[o].sum=a.total.intermediate[o].actually+a.total.intermediate[o].plan;if(t[l].RSLevelReq){const o=t[l].RSLevelReq[s.plan[l]-1]||0;c=a.total.result.RSLevelReq=c<o?o:c}if(t[l].TimeToUpgrade){const o=t[l],M=s.actually[l],D=s.plan[l],y=[];for(let p=0;p<D-M;p++){const v=M+p,A=o.TimeToUpgrade[v]/3600;for(let N=0;N<A;N++)y.push(o.Cost[v]/(o.TimeToUpgrade[v]/3600))}y.length?e[l]=y:delete e[l],Object.keys(e).length&&(Ae(Object.values(e)).forEach(p=>{const v=p.reduce((A,N)=>A+N||0,0);d+=Math.ceil(v/u)}),a.total.result.TimeToUpgradeParallel=d*3600)}}}function ae(...[t,a,c]){const e=x.state.userSettings.planetsCalcSp2?B/100:0,l=k(Z,{filter:([,i])=>Array.isArray(i)}),s=k(Se,{...ye("planets.yellowstar"),map:([i,r])=>(c[i]=k(l,{map:([o,M])=>{const D=r.MaxUpgradeLevel,y=(r.Name in w?w[r.Name]:0)+1;let p=M.map(v=>v*(o in b?r[b[o]]/100:1));return o=="ShipmentsCRValuePerDay"&&(p=p.map(v=>{const A=v*y;return A+A*e})),o=="MaxShipments"&&(p=p.map(v=>v*y)),p.length<D&&p.push(...Array.from({length:D-p.length},()=>p[p.length-1])),[o,p]}}),t[i]=r.TID,[i,r])});let u=0;const d=k(Ce.TradingStation,{map:([i,r])=>(Array.isArray(r)&&r.length>u&&(u=r.length),i=="TotalShipmentCRPerDay"&&(r=r.map(o=>o+o*e)),[i in E?E[i]:i,r])});d.MaxUpgradeLevel=u;for(let i=0;d.MaxOnOwnSolarSystem>i;i++){const r={...d,Name:`${d.Name}_${i}`};s[r.Name]=r,c[r.Name]=a(r,u)}return s}return(t,a)=>{const c=ce("t");return m(),_("div",Pe,[n("div",Re,[U(Te,{input:S.value,"onUpdate:input":a[0]||(a[0]=e=>S.value=e),"stack-chars":$,"calc-total":te,"local-storage-key":"planetsCalc","title-key":"PLANETS_CALC",onSetup:z},null,8,["input"]),n("div",Ie,[n("div",null,[j(n("p",be,null,512),[[c,"TID_STARTER_PACK_2"]]),Ee]),n("input",{id:"compact-mode",class:"checkbox",type:"checkbox",checked:t.$store.state.userSettings.planetsCalcSp2,onChange:a[1]||(a[1]=e=>t.$store.commit(L(H).SWITCH_PLANETS_CALC_SP2))},null,40,Me),De]),U(he,{data:{TID:"INPUT_VALUES",Name:"Input",TID2:["",...h.value.map(e=>e.TID)]},"table-opts":{lvlColKey:"â„–",mergeCells:!1,colLvlStartAt:0}},{"table-head":q(()=>[j(n("th",null,null,512),[[c,"CURRENT_LVL"]]),j(n("th",null,null,512),[[c,"PLAN_LVL"]]),Ne]),"table-body":q(({row:e})=>[e==0?(m(),_(C,{key:0},[(m(!0),_(C,null,P(S.value,(l,s)=>(m(),_("td",{key:s},[n("select",{class:"select",onChange:u=>ee(s,u.target.value)},[(m(!0),_(C,null,P(h.value[e].MaxUpgradeLevel+1,(u,d)=>(m(),_("option",{key:s+u,selected:L(f).isSelected(s,h.value[e].Name,d)},R(d),9,ke))),128))],40,Ue)]))),128)),xe],64)):(m(),_(C,{key:1},[(m(!0),_(C,null,P(S.value,(l,s)=>{var u,d;return m(),_("td",{key:s},[n("div",Oe,[U(Le,{value:((u=S.value[s])==null?void 0:u[h.value[e-1].Name])||0,min:(s=="plan"?(d=S.value.actually)==null?void 0:d[h.value[e-1].Name]:0)||0,max:h.value[e-1].MaxUpgradeLevel,"onUpdate:value":i=>L(f).onChangeLvl(s,h.value[e-1].Name,i)},null,8,["value","min","max","onUpdate:value"])])])}),128)),n("td",null,[n("div",{onClick:()=>Q(h.value[e-1])},je,8,Ve)])],64))]),_:1},8,["data"])]),U(de,ue({open:O.value,"onUpdate:open":a[2]||(a[2]=e=>O.value=e)},T),{body:q(()=>[n("div",qe,[n("ul",Fe,[n("li",Be,[n("b",null,R(t.$t("TID_PLANET_LEVEL_DESCR")),1),n("div",null,[(m(!0),_(C,null,P(S.value,(e,l)=>{var s;return m(),_("span",{key:l,class:X(G(l,null))},R((s=S.value[l])==null?void 0:s[T.data.key]),3)}),128))])]),(m(!0),_(C,null,P(Object.keys(L(f).output.plan[T.data.key]||{}).filter(e=>!K.includes(e)),e=>(m(),_("li",{key:e,class:"calc.output"},[n("b",null,R(L(f).format.key(e)),1),n("div",null,[(m(!0),_(C,null,P(S.value,(l,s)=>{var u,d;return m(),_("span",{key:s,class:X(G(s,e))},R(L(f).format.value(e,Math.trunc((d=(u=L(f).output[s])==null?void 0:u[T.data.key])==null?void 0:d[e])||void 0)),3)}),128))])]))),128))])])]),_:1},16,["open"])])}}}),et=ve($e,[["__scopeId","data-v-814dda8c"]]);export{et as default};
