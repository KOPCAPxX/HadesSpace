var pt=Object.defineProperty;var ht=(a,c,n)=>c in a?pt(a,c,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[c]=n;var P=(a,c,n)=>(ht(a,typeof c!="symbol"?c+"":c,n),n);import{m as lt,A as gt,aF as q,aJ as mt,d as yt,g as Ct,O as vt,l as U,a as K,r as bt,o as D,b as R,e as N,h as B,f as h,t as M,u as S,H as _t,F as j,D as G,w,C as F,B as St,aK as Et,K as W,S as X,M as Q,aL as At,G as It,p as Ot,i as Tt,_ as wt}from"./index-_3hBK0XR.js";import{C as Lt}from"./TheConfirm-ef0VKfjz.js";import{o as z,i as tt,k as Dt,v as Rt}from"./Data-jvDJbZdk.js";import{s as V}from"./globals-zpsYnYkF.js";function Mt(a,c){const n=lt({actually:{},plan:{},total:{intermediate:{},result:{}}}),u={};for(const p of a)n.total.result[p]=0;const e=c(u,n);return{provideGetterElements:v,output:n,update:E};function v(p){return p(L,u)}function E(p,l){const o=(r,C)=>I(r,([y],b,A)=>m(Object.fromEntries(A),y,p.actually[r],C)),i=(r,C)=>I(r,([,y])=>Array.isArray(y)?y[C-1]:y);l?(f(n.plan,l,o(l,p.plan[l])),f(n.actually,l,i(l,p.actually[l]))):(O(p.plan,n.plan,o),O(p.actually,n.actually,i)),x(n.total);for(const[r,C]of Object.entries(n.plan))if(Object.keys(C).length){for(const y of a)n.total.result[y]+=C[y];e(r,p)}}function I(p,l){return(...o)=>{const[[i]]=o;if(J(u[p][i])){const C=z(u[p][i],{map:(...y)=>[y[0][0],l(...y)]});return[i,C]}const r=l(...o);return[i,r]}}function f(p,l,o){u[l]&&(p[l]=z(u[l],{map:o}))}function O(p,l,o){if(Object.keys(p).length)for(const[i,r]of Object.entries(p))r?f(l,i,o(i,r)):l[i]={};else for(const i of Object.keys(l))delete l[i]}function m(p,l,o,i){const r=p[l],C=o>0?r[o-1]:0;let y=r[i-1];if(!Array.isArray(r))return!o&&i?r:0;if(a.includes(l)){y=0;let b=o>0?o-1:0;for(;b<=i-1;)y+=r[b],b++}return y-C}function x(p){for(const l in p)if(l in p){if(J(p[l])){x(p[l]);continue}p[l]=0}}function L(p,l){const o=xt(p);return i(o),o;function i(r){for(const C in r)if(C in r){const y=r[C],b=typeof y[1]=="boolean"?y[0]:y;if(J(b)){const A=L(b,l);Object.keys(A).length?r[C]=A:delete r[C];continue}else if(!(Array.isArray(b)&&b.length==l)&&!a.includes(C)){delete r[C];continue}typeof y[1]=="boolean"&&(r[C]=b)}return r}}}function J(a){return typeof a=="object"&&!Array.isArray(a)&&a!==null}function xt(a){const c=gt(),n=z(a,{map:([u,e])=>[u,[e,tt(u,a.Name)]],filter:([u,[,e]])=>u.startsWith("_")||tt(u,null,{asMeta:!0,asTitle:!1})?!1:c.state.userSettings.disableFilters?!0:!e});if(a.projectile){const{projectile:u}=n;delete n.projectile,n.projectile=u}return n}const et={crush:(a,c=50)=>{const n="",u=(f,O)=>{let m=O.length,x="";const L=o=>encodeURI(encodeURIComponent(o)).replace(/%../g,"i").length,p=o=>{let i=o.charCodeAt(0),r=o.charCodeAt(o.length-1);return i>=56320&&i<=57343||r>=55296&&r<=56319};let l={};for(let o=2;o<c;o++)for(let i=0;i<f.length-o;++i){let r=f.substr(i,o);if(l[r]||p(r))continue;let C=1;for(let y=f.indexOf(r,i+o);y>=0;++C)y=f.indexOf(r,y+o);C>1&&(l[r]=C)}for(;;){for(;m--&&f.includes(O[m]););if(m<0)break;let o=O[m],i,r=0,C=L(o);for(let b in l){let A=l[b],T=(A-1)*L(b)-(A+1)*C;x.length||(T-=L(n)),T<=0?delete l[b]:T>r&&(i=b,r=T)}if(!i)break;f=f.split(i).join(o)+o+i,x=o+x;let y={};for(let b in l){let A=b.split(i).join(o),T=0;for(let $=f.indexOf(A);$>=0;++T)$=f.indexOf(A,$+A.length);T>1&&(y[A]=T)}l=y}return{a:f,b:x}};let e=[];const v="-_.!~*'()";for(let f=127;--f;)(f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||v.includes(String.fromCharCode(f)))&&e.push(String.fromCharCode(f));for(let f=32;f<255;++f){let O=String.fromCharCode(f);O!="\\"&&!e.includes(O)&&e.unshift(O)}a=a.replace(new RegExp(n,"g"),""),a=nt(a);const E=u(a,e);let I=E.a;return E.b.length&&(I+=n+E.b),I+="_",I},uncrush:a=>{a=a.substring(0,a.length-1);const c=a.split("");let n=c[0];if(c.length>1){let u=c[1];for(let e of u){let v=n.split(e);n=v.join(v.pop())}}return nt(n,0)}},nt=(a,c=1)=>{const n=[['"',"'"],["':","!"],[",'","~"],["}",")","\\","\\"],["{","(","\\","\\"]],u=(e,v)=>{let E=new RegExp(`${(v[2]?v[2]:"")+v[0]}|${(v[3]?v[3]:"")+v[1]}`,"g");return e.replace(E,I=>I===v[0]?v[1]:v[0])};if(c)for(let e=0;e<n.length;++e)a=u(a,n[e]);else for(let e=n.length;e--;)a=u(a,n[e]);return a},st="new entry",H="en";class $t{constructor(c){P(this,"store");P(this,"TIDs",{});this.localStoreKey=c,this.store=lt({configs:[],selected:0}),this.load()}get selectedConfig(){return this.store.configs[this.store.selected].value}load(){const c=JSON.parse(localStorage.getItem(this.localStoreKey)||"{}");if(c.configs){Object.assign(this.store,c);return}if(Object.keys(c).length&&c.actually&&c.plan){this.add(c);return}this.add()}save(){localStorage.setItem(this.localStoreKey,JSON.stringify(this.store))}removeSelected(){if(this.store.configs.splice(this.store.selected,1),this.store.configs.length==0){this.add();return}this.store.selected=this.store.configs.length-1}add(c,{temporary:n}={temporary:!1}){const u=this.store;let e=0,v;do v=e?`${st} #${e}`:st,e++;while(u.configs.length&&u.configs.some(E=>E.name==v));u.configs=[...u.configs,{name:v,value:c||{actually:{},plan:{}}}],u.selected=u.configs.length-1,n||this.save()}async parseString(c){const n=[];q.global.availableLocales.includes(H)||await mt(H);for(const[u,e]of Object.entries(this.TIDs)){const v=q.global.t(e,H),E=new RegExp(`${v}\\s+?(\\d+)\\s?`,"mi"),[,I]=c.match(E)||[void 0,"0"];n.push([u,parseInt(I)])}return Object.fromEntries(n.filter(([,u])=>u))}stringifyUrl(){const c=JSON.stringify(this.selectedConfig.actually);return et.crush(c)}parseUrl(c){return JSON.parse(et.uncrush(c))}}const Ft=a=>(Ot("data-v-e051d90b"),a=a(),Tt(),a),Ut={class:"topic"},Nt={class:"total-table"},jt={key:0,colspan:"3"},Gt={class:"buttons"},kt={class:"reset-buttons"},Pt={class:"settings-modal"},Kt={class:"input-wrap"},Bt=["value"],Vt={class:"config-category"},Jt={class:"flex-end"},Ht={class:"select"},zt={class:"name"},Yt=["value"],Zt={class:"input"},qt={class:"name"},Wt=["placeholder"],Xt={class:"flex-end margin-bottom"},Qt={class:"input"},te={class:"name"},ee=Ft(()=>h("p",{class:"name"},"Example: Fortify 8 Bond 5",-1)),ne={class:"flex-end margin-bottom"},se=yt({__name:"Calculator",props:{stackChars:{},calcTotal:{},localStorageKey:{},titleKey:{},input:{}},emits:["update:input","setup"],setup(a,{emit:c}){const{t:n}=Ct(),u=vt(),e=a,v=c,E={key:s=>Dt(s,u.currentRoute.value.name),value:(s,t)=>Rt(s,t,u.currentRoute.value.name)},{provideGetterElements:I,output:f,update:O}=Mt(e.stackChars,e.calcTotal),m=new $t(e.localStorageKey),x={output:f,onChangeLvl:k,isSelected:ct,isDisabled:ut,outputClasses:ft,forceReCalc:$,format:E,provideGetterElements:s=>I((...t)=>s(m.TIDs,...t))};let L=()=>Promise.prototype;const p=U(!1),l=U(!1),o=U(""),i=U({text:n("COPY"),color:"yellow"}),r=K(()=>n(e.titleKey)),C=K(()=>Object.keys(f.total.result)),y=K(()=>`${location.origin}${location.pathname}`);if(u.currentRoute.value.query.d){const s=m.parseUrl(u.currentRoute.value.query.d),t={actually:{...s},plan:{...s}};m.add(t,{temporary:!0})}$(),v("setup",x);function b(s){L=s}function A(){v("update:input",m.selectedConfig)}function T(s){At(()=>O(e.input,s))}function $(){A(),T()}async function Y(s){if(s.target.name=="all")await L("Reset all ? Are you serious ?").then(()=>{for(const t in e.input)t in e.input&&(m.selectedConfig[t]={})}).catch(()=>{});else if(e.input.plan)for(const t in e.input.plan)t in e.input.plan&&(m.selectedConfig.plan[t]=e.input.actually[t]);T(),m.save()}async function ot(){const{name:s}=m.store.configs[m.store.selected];await L(n("REMOVE_CONFIG",[s])).then(()=>{m.removeSelected(),$()}).catch(()=>{})}async function at(){let s={};o.value&&await m.parseString(o.value).then(t=>s=t).catch(t=>{alert(t.message),console.error(t)}),m.add({actually:{...s},plan:{...s}}),o.value="",l.value=!1,$()}function rt(){const s=m.stringifyUrl();navigator.clipboard.writeText(`${y.value}?d=${s}`).then(()=>{i.value={text:n("COPIED"),color:"green"},setTimeout(()=>i.value={text:n("COPY"),color:"yellow"},2e3)}).catch(t=>{i.value={text:n("Error"),color:"red"},alert(t.message),console.error(t)})}function it(s,t){const d=f.total.intermediate[t];if(s=="plan")return{"yellow-color plus":d.plan,hide:d.plan==0};if(s=="sum"){const g=d.sum>d.actually;return{"green-color ":g,muffle:!g,hide:d.sum==0}}return{}}function k(s,t,d){d=typeof d=="string"?parseInt(d):d,d==0?(delete e.input[s][t],delete f[s][t]):m.selectedConfig[s][t]=d;const g=e.input.plan[t]||0,_=e.input.actually[t];return _>g&&k("plan",t,_),A(),T(t),m.save(),d}function ct(s,t,d){let g=e.input.plan[t]||0;const _=e.input.actually[t];return _>g&&(g=k("plan",t,_)),s=="plan"?d==g:e.input[s][t]==d}function ut(s,t,d){return s!="plan"||!e.input.actually?!1:d<e.input.actually[t]}function ft(s,t,d){if(s=="actually")return{none:d&&C.value.includes(d),actually:!0};if(s=="plan"){const g=d?f[s][t][d]:void 0;return{"yellow-color":(e.input.actually[t]?e.input.plan[t]>e.input.actually[t]:!0)&&typeof g!="object",plus:!d||d&&!C.value.includes(d),none:e.input.plan[t]==e.input.actually[t],plan:!0}}return{}}return(s,t)=>{const d=bt("t");return D(),R("div",null,[N(S(_t),null,{default:B(()=>[h("title",null,M(r.value),1)]),_:1}),h("h1",Ut,M(r.value),1),h("table",Nt,[(D(!0),R(j,null,G(S(f).total.intermediate,(g,_)=>(D(),R("tr",{key:_},[h("td",{class:F([S(V)(_),"stats-style"])},M(E.key(_)),3),(D(!0),R(j,null,G(g,(dt,Z)=>(D(),R("td",{key:_+Z,class:F(it(Z,_))},M(dt.toLocaleString("ru-RU")),3))),128))]))),128)),(D(!0),R(j,null,G(S(f).total.result,(g,_)=>(D(),R("tr",{key:_,class:"result"},[h("td",{class:F([S(V)(_),"stats-style"])},M(E.key(_)),3),g>0?(D(),R("td",jt,[h("b",null,M(E.value(_,g)),1)])):It("",!0)]))),128))]),h("div",Gt,[h("button",{class:"settings",onClick:t[0]||(t[0]=g=>p.value=!0)}),h("div",kt,[h("button",{class:"button yellow",name:"plan",onClick:Y},M(s.$t("RESET_PLAN")),1),h("button",{class:"button red",name:"all",onClick:Y},M(s.$t("RESET_ALL")),1)])]),N(Q,{open:p.value,"onUpdate:open":[t[6]||(t[6]=g=>p.value=g),t[7]||(t[7]=()=>S(m).save())],title:s.$t("CALCULATOR_SETTINGS"),size:S(X).MEDIUM},{body:B(()=>[h("div",Pt,[h("div",Kt,[w(h("p",{class:F(["stats-style",S(V)("CreditStorage")])},null,2),[[d,"TID_PLANET_UPG_CREDIT_YIELD"]]),h("input",{value:s.$store.state.userSettings.calcDayCreditLimit,type:"number",min:"0",onInput:t[1]||(t[1]=g=>s.$store.commit(S(St).SET_CALC_DAY_CREDIT_LIMIT,parseInt(g.target.value)))},null,40,Bt)]),h("div",Vt,[w(h("p",null,null,512),[[d,"CONFIG"]]),h("div",Jt,[h("button",{class:F(`button ${i.value.color}`),onClick:rt},M(i.value.text),3),w(h("button",{class:"button green",onClick:t[2]||(t[2]=g=>l.value=!0)},null,512),[[d,"CREATE"]])])]),h("div",Ht,[w(h("p",zt,null,512),[[d,"LIST"]]),w(h("select",{"onUpdate:modelValue":t[3]||(t[3]=g=>S(m).store.selected=g),onChange:t[4]||(t[4]=g=>$())},[(D(!0),R(j,null,G(S(m).store.configs,(g,_)=>(D(),R("option",{key:_,value:_},M(g.name),9,Yt))),128))],544),[[Et,S(m).store.selected]])]),h("div",Zt,[w(h("p",qt,null,512),[[d,"TID_CHANGE_NAME_TITLE"]]),w(h("input",{"onUpdate:modelValue":t[5]||(t[5]=g=>S(m).store.configs[S(m).store.selected].name=g),placeholder:s.$t("TID_CORP_NAME_LABEL")},null,8,Wt),[[W,S(m).store.configs[S(m).store.selected].name]])]),h("div",Xt,[w(h("button",{class:"button red",onClick:ot},null,512),[[d,"TID_SOCIAL_DELETE_MESSAGE"]])])])]),_:1},8,["open","title","size"]),N(Lt,{onSetShow:b}),N(Q,{open:l.value,"onUpdate:open":t[9]||(t[9]=g=>l.value=g),title:s.$t("CREATE"),size:S(X).SMALL},{body:B(()=>[h("div",Qt,[w(h("p",te,null,512),[[d,"FROM_TEXT_FORMAT"]]),ee,w(h("input",{"onUpdate:modelValue":t[8]||(t[8]=g=>o.value=g)},null,512),[[W,o.value]])]),h("div",ne,[w(h("button",{class:"button green",onClick:at},null,512),[[d,"TID_OK"]])])]),_:1},8,["open","title","size"])])}}}),ce=wt(se,[["__scopeId","data-v-e051d90b"]]);export{ce as C};
