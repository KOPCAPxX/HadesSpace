var pt=Object.defineProperty;var ht=(a,i,n)=>i in a?pt(a,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[i]=n;var P=(a,i,n)=>(ht(a,typeof i!="symbol"?i+"":i,n),n);import{m as lt,A as gt,aF as q,aJ as mt,d as yt,g as Ct,O as vt,l as U,a as K,r as bt,o as D,b as R,e as N,h as B,f as h,t as M,u as E,H as _t,F as j,D as G,w,C as F,B as St,aK as Et,K as W,S as X,M as Q,aL as At,G as It,p as Ot,i as Tt,_ as wt}from"./index-1O-5-HxU.js";import{C as Lt}from"./TheConfirm-GhnbWdhq.js";import{o as z,i as tt,k as Dt,v as Rt}from"./Data-8mnPcPkC.js";import{s as V}from"./globals-zpsYnYkF.js";function Mt(a,i){const n=lt({actually:{},plan:{},total:{intermediate:{},result:{}}}),u={};for(const p of a)n.total.result[p]=0;const e=i(u,n);return{provideGetterElements:C,output:n,update:b};function C(p){return p(L,u)}function b(p,l){const o=(r,v)=>I(r,([y],_,A)=>m(Object.fromEntries(A),y,p.actually[r],v)),c=(r,v)=>I(r,([,y])=>Array.isArray(y)?y[v-1]:y);l?(f(n.plan,l,o(l,p.plan[l])),f(n.actually,l,c(l,p.actually[l]))):(O(p.plan,n.plan,o),O(p.actually,n.actually,c)),x(n.total);for(const[r,v]of Object.entries(n.plan))if(Object.keys(v).length){for(const y of a)n.total.result[y]+=v[y];e(r,p)}}function I(p,l){return(...o)=>{const[[c]]=o;if(J(u[p][c])){const v=z(u[p][c],{map:(...y)=>[y[0][0],l(...y)]});return[c,v]}const r=l(...o);return[c,r]}}function f(p,l,o){u[l]&&(p[l]=z(u[l],{map:o}))}function O(p,l,o){if(Object.keys(p).length)for(const[c,r]of Object.entries(p))r?f(l,c,o(c,r)):l[c]={};else for(const c of Object.keys(l))delete l[c]}function m(p,l,o,c){const r=p[l],v=o>0?r[o-1]:0;let y=r[c-1];if(!Array.isArray(r))return!o&&c?r:0;if(a.includes(l)){y=0;let _=o>0?o-1:0;for(;_<=c-1;)y+=r[_],_++}return y-v}function x(p){for(const l in p)if(l in p){if(J(p[l])){x(p[l]);continue}p[l]=0}}function L(p,l){const o=xt(p);return c(o),o;function c(r){for(const v in r)if(v in r){const y=r[v],_=typeof y[1]=="boolean"?y[0]:y;if(J(_)){const A=L(_,l);Object.keys(A).length?r[v]=A:delete r[v];continue}else if(!(Array.isArray(_)&&_.length==l)&&!a.includes(v)){delete r[v];continue}typeof y[1]=="boolean"&&(r[v]=_)}return r}}}function J(a){return typeof a=="object"&&!Array.isArray(a)&&a!==null}function xt(a){const i=gt(),n=z(a,{map:([u,e])=>[u,[e,tt(u,a.Name)]],filter:([u,[,e]])=>{var C,b;return u.startsWith("_")||tt(u,null,{asMeta:!0,asTitle:!1})?!1:(b=(C=i==null?void 0:i.state)==null?void 0:C.userSettings)!=null&&b.disableFilters?!0:!e}});if(a.projectile){const{projectile:u}=n;delete n.projectile,n.projectile=u}return n}const et={crush:(a,i=50)=>{const n="",u=(f,O)=>{let m=O.length,x="";const L=o=>encodeURI(encodeURIComponent(o)).replace(/%../g,"i").length,p=o=>{let c=o.charCodeAt(0),r=o.charCodeAt(o.length-1);return c>=56320&&c<=57343||r>=55296&&r<=56319};let l={};for(let o=2;o<i;o++)for(let c=0;c<f.length-o;++c){let r=f.substr(c,o);if(l[r]||p(r))continue;let v=1;for(let y=f.indexOf(r,c+o);y>=0;++v)y=f.indexOf(r,y+o);v>1&&(l[r]=v)}for(;;){for(;m--&&f.includes(O[m]););if(m<0)break;let o=O[m],c,r=0,v=L(o);for(let _ in l){let A=l[_],T=(A-1)*L(_)-(A+1)*v;x.length||(T-=L(n)),T<=0?delete l[_]:T>r&&(c=_,r=T)}if(!c)break;f=f.split(c).join(o)+o+c,x=o+x;let y={};for(let _ in l){let A=_.split(c).join(o),T=0;for(let $=f.indexOf(A);$>=0;++T)$=f.indexOf(A,$+A.length);T>1&&(y[A]=T)}l=y}return{a:f,b:x}};let e=[];const C="-_.!~*'()";for(let f=127;--f;)(f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||C.includes(String.fromCharCode(f)))&&e.push(String.fromCharCode(f));for(let f=32;f<255;++f){let O=String.fromCharCode(f);O!="\\"&&!e.includes(O)&&e.unshift(O)}a=a.replace(new RegExp(n,"g"),""),a=nt(a);const b=u(a,e);let I=b.a;return b.b.length&&(I+=n+b.b),I+="_",I},uncrush:a=>{a=a.substring(0,a.length-1);const i=a.split("");let n=i[0];if(i.length>1){let u=i[1];for(let e of u){let C=n.split(e);n=C.join(C.pop())}}return nt(n,0)}},nt=(a,i=1)=>{const n=[['"',"'"],["':","!"],[",'","~"],["}",")","\\","\\"],["{","(","\\","\\"]],u=(e,C)=>{let b=new RegExp(`${(C[2]?C[2]:"")+C[0]}|${(C[3]?C[3]:"")+C[1]}`,"g");return e.replace(b,I=>I===C[0]?C[1]:C[0])};if(i)for(let e=0;e<n.length;++e)a=u(a,n[e]);else for(let e=n.length;e--;)a=u(a,n[e]);return a},st="new entry",H="en";class $t{constructor(i){P(this,"store");P(this,"TIDs",{});this.localStoreKey=i,this.store=lt({configs:[],selected:0}),this.load()}get selectedConfig(){return this.store.configs[this.store.selected].value}load(){const i=JSON.parse(localStorage.getItem(this.localStoreKey)||"{}");if(i.configs){Object.assign(this.store,i);return}if(Object.keys(i).length&&i.actually&&i.plan){this.add(i);return}this.add()}save(){localStorage.setItem(this.localStoreKey,JSON.stringify(this.store))}removeSelected(){if(this.store.configs.splice(this.store.selected,1),this.store.configs.length==0){this.add();return}this.store.selected=this.store.configs.length-1}add(i,{temporary:n}={temporary:!1}){const u=this.store;let e=0,C;do C=e?`${st} #${e}`:st,e++;while(u.configs.length&&u.configs.some(b=>b.name==C));u.configs=[...u.configs,{name:C,value:i||{actually:{},plan:{}}}],u.selected=u.configs.length-1,n||this.save()}async parseString(i){const n=[];q.global.availableLocales.includes(H)||await mt(H);for(const[u,e]of Object.entries(this.TIDs)){const C=q.global.t(e,H),b=new RegExp(`${C}\\s+?(\\d+)\\s?`,"mi"),[,I]=i.match(b)||[void 0,"0"];n.push([u,parseInt(I)])}return Object.fromEntries(n.filter(([,u])=>u))}stringifyUrl(){const i=JSON.stringify(this.selectedConfig.actually);return et.crush(i)}parseUrl(i){return JSON.parse(et.uncrush(i))}}const Ft=a=>(Ot("data-v-e051d90b"),a=a(),Tt(),a),Ut={class:"topic"},Nt={class:"total-table"},jt={key:0,colspan:"3"},Gt={class:"buttons"},kt={class:"reset-buttons"},Pt={class:"settings-modal"},Kt={class:"input-wrap"},Bt=["value"],Vt={class:"config-category"},Jt={class:"flex-end"},Ht={class:"select"},zt={class:"name"},Yt=["value"],Zt={class:"input"},qt={class:"name"},Wt=["placeholder"],Xt={class:"flex-end margin-bottom"},Qt={class:"input"},te={class:"name"},ee=Ft(()=>h("p",{class:"name"},"Example: Fortify 8 Bond 5",-1)),ne={class:"flex-end margin-bottom"},se=yt({__name:"Calculator",props:{stackChars:{},calcTotal:{},localStorageKey:{},titleKey:{},input:{}},emits:["update:input","setup"],setup(a,{emit:i}){const{t:n}=Ct(),u=vt(),e=a,C=i,b={key:s=>Dt(s,u.currentRoute.value.name),value:(s,t)=>Rt(s,t,u.currentRoute.value.name)},{provideGetterElements:I,output:f,update:O}=Mt(e.stackChars,e.calcTotal),m=new $t(e.localStorageKey),x={output:f,onChangeLvl:k,isSelected:ct,isDisabled:ut,outputClasses:ft,forceReCalc:$,format:b,provideGetterElements:s=>I((...t)=>s(m.TIDs,...t))};let L=()=>Promise.prototype;const p=U(!1),l=U(!1),o=U(""),c=U({text:n("COPY"),color:"yellow"}),r=K(()=>n(e.titleKey)),v=K(()=>Object.keys(f.total.result)),y=K(()=>`${location.origin}${location.pathname}`);if(u.currentRoute.value.query.d){const s=m.parseUrl(u.currentRoute.value.query.d),t={actually:{...s},plan:{...s}};m.add(t,{temporary:!0})}$(),C("setup",x);function _(s){L=s}function A(){C("update:input",m.selectedConfig)}function T(s){At(()=>O(e.input,s))}function $(){A(),T()}async function Y(s){if(s.target.name=="all")await L("Reset all ? Are you serious ?").then(()=>{for(const t in e.input)t in e.input&&(m.selectedConfig[t]={})}).catch(()=>{});else if(e.input.plan)for(const t in e.input.plan)t in e.input.plan&&(m.selectedConfig.plan[t]=e.input.actually[t]);T(),m.save()}async function ot(){const{name:s}=m.store.configs[m.store.selected];await L(n("REMOVE_CONFIG",[s])).then(()=>{m.removeSelected(),$()}).catch(()=>{})}async function at(){let s={};o.value&&await m.parseString(o.value).then(t=>s=t).catch(t=>{alert(t.message),console.error(t)}),m.add({actually:{...s},plan:{...s}}),o.value="",l.value=!1,$()}function rt(){const s=m.stringifyUrl();navigator.clipboard.writeText(`${y.value}?d=${s}`).then(()=>{c.value={text:n("COPIED"),color:"green"},setTimeout(()=>c.value={text:n("COPY"),color:"yellow"},2e3)}).catch(t=>{c.value={text:n("Error"),color:"red"},alert(t.message),console.error(t)})}function it(s,t){const d=f.total.intermediate[t];if(s=="plan")return{"yellow-color plus":d.plan,hide:d.plan==0};if(s=="sum"){const g=d.sum>d.actually;return{"green-color ":g,muffle:!g,hide:d.sum==0}}return{}}function k(s,t,d){d=typeof d=="string"?parseInt(d):d,d==0?(delete e.input[s][t],delete f[s][t]):m.selectedConfig[s][t]=d;const g=e.input.plan[t]||0,S=e.input.actually[t];return S>g&&k("plan",t,S),A(),T(t),m.save(),d}function ct(s,t,d){let g=e.input.plan[t]||0;const S=e.input.actually[t];return S>g&&(g=k("plan",t,S)),s=="plan"?d==g:e.input[s][t]==d}function ut(s,t,d){return s!="plan"||!e.input.actually?!1:d<e.input.actually[t]}function ft(s,t,d){if(s=="actually")return{none:d&&v.value.includes(d),actually:!0};if(s=="plan"){const g=d?f[s][t][d]:void 0;return{"yellow-color":(e.input.actually[t]?e.input.plan[t]>e.input.actually[t]:!0)&&typeof g!="object",plus:!d||d&&!v.value.includes(d),none:e.input.plan[t]==e.input.actually[t],plan:!0}}return{}}return(s,t)=>{const d=bt("t");return D(),R("div",null,[N(E(_t),null,{default:B(()=>[h("title",null,M(r.value),1)]),_:1}),h("h1",Ut,M(r.value),1),h("table",Nt,[(D(!0),R(j,null,G(E(f).total.intermediate,(g,S)=>(D(),R("tr",{key:S},[h("td",{class:F([E(V)(S),"stats-style"])},M(b.key(S)),3),(D(!0),R(j,null,G(g,(dt,Z)=>(D(),R("td",{key:S+Z,class:F(it(Z,S))},M(dt.toLocaleString("ru-RU")),3))),128))]))),128)),(D(!0),R(j,null,G(E(f).total.result,(g,S)=>(D(),R("tr",{key:S,class:"result"},[h("td",{class:F([E(V)(S),"stats-style"])},M(b.key(S)),3),g>0?(D(),R("td",jt,[h("b",null,M(b.value(S,g)),1)])):It("",!0)]))),128))]),h("div",Gt,[h("button",{class:"settings",onClick:t[0]||(t[0]=g=>p.value=!0)}),h("div",kt,[h("button",{class:"button yellow",name:"plan",onClick:Y},M(s.$t("RESET_PLAN")),1),h("button",{class:"button red",name:"all",onClick:Y},M(s.$t("RESET_ALL")),1)])]),N(Q,{open:p.value,"onUpdate:open":[t[6]||(t[6]=g=>p.value=g),t[7]||(t[7]=()=>E(m).save())],title:s.$t("CALCULATOR_SETTINGS"),size:E(X).MEDIUM},{body:B(()=>[h("div",Pt,[h("div",Kt,[w(h("p",{class:F(["stats-style",E(V)("CreditStorage")])},null,2),[[d,"TID_PLANET_UPG_CREDIT_YIELD"]]),h("input",{value:s.$store.state.userSettings.calcDayCreditLimit,type:"number",min:"0",onInput:t[1]||(t[1]=g=>s.$store.commit(E(St).SET_CALC_DAY_CREDIT_LIMIT,parseInt(g.target.value)))},null,40,Bt)]),h("div",Vt,[w(h("p",null,null,512),[[d,"CONFIG"]]),h("div",Jt,[h("button",{class:F(`button ${c.value.color}`),onClick:rt},M(c.value.text),3),w(h("button",{class:"button green",onClick:t[2]||(t[2]=g=>l.value=!0)},null,512),[[d,"CREATE"]])])]),h("div",Ht,[w(h("p",zt,null,512),[[d,"LIST"]]),w(h("select",{"onUpdate:modelValue":t[3]||(t[3]=g=>E(m).store.selected=g),onChange:t[4]||(t[4]=g=>$())},[(D(!0),R(j,null,G(E(m).store.configs,(g,S)=>(D(),R("option",{key:S,value:S},M(g.name),9,Yt))),128))],544),[[Et,E(m).store.selected]])]),h("div",Zt,[w(h("p",qt,null,512),[[d,"TID_CHANGE_NAME_TITLE"]]),w(h("input",{"onUpdate:modelValue":t[5]||(t[5]=g=>E(m).store.configs[E(m).store.selected].name=g),placeholder:s.$t("TID_CORP_NAME_LABEL")},null,8,Wt),[[W,E(m).store.configs[E(m).store.selected].name]])]),h("div",Xt,[w(h("button",{class:"button red",onClick:ot},null,512),[[d,"TID_SOCIAL_DELETE_MESSAGE"]])])])]),_:1},8,["open","title","size"]),N(Lt,{onSetShow:_}),N(Q,{open:l.value,"onUpdate:open":t[9]||(t[9]=g=>l.value=g),title:s.$t("CREATE"),size:E(X).SMALL},{body:B(()=>[h("div",Qt,[w(h("p",te,null,512),[[d,"FROM_TEXT_FORMAT"]]),ee,w(h("input",{"onUpdate:modelValue":t[8]||(t[8]=g=>o.value=g)},null,512),[[W,o.value]])]),h("div",ne,[w(h("button",{class:"button green",onClick:at},null,512),[[d,"TID_OK"]])])]),_:1},8,["open","title","size"])])}}}),ce=wt(se,[["__scopeId","data-v-e051d90b"]]);export{ce as C};
