import{d as le,A as se,g as oe,l as x,m as ne,S as re,a as ie,B as H,r as ce,o as d,b as p,f as n,e as N,w as j,u as A,h as q,F as C,D as P,t as b,v as ue,M as de,s as pe,C as X,p as me,i as _e,aI as ve,_ as fe}from"./index-1O-5-HxU.js";import{l as Z,Y as F}from"./planet_levels-OgGYPt_4.js";import{o as k,p as Se,V as he}from"./Data-8mnPcPkC.js";import{s as Ce}from"./spacebuildings-NmTc9Pj4.js";import{g as ge}from"./globals-zpsYnYkF.js";import{C as Te}from"./Calculator-I7WmZX5d.js";import{N as Le}from"./NumberPicker-upG_SZ4s.js";import{g as ye}from"./getFilterByType-aSftiFBn.js";import"./sec2str-AutV4QMP.js";import"./TheConfirm-GhnbWdhq.js";import"./byTypes-1BYQ2hUk.js";function Ae(g){return g[0].map((B,R)=>g.map(M=>M[R]))}const E=g=>(me("data-v-27729408"),g=g(),_e(),g),Pe={class:"wrap"},Re={class:"container"},Ie={class:"switch"},De={class:"name"},be=E(()=>n("p",null,null,-1)),Ee=["checked"],Me=E(()=>n("label",{for:"compact-mode",class:"label"},null,-1)),Ne=E(()=>n("th",null,null,-1)),ke=["onChange"],Ue=["selected"],Ve=E(()=>n("td",null,null,-1)),Oe={class:"number-picker"},xe=["onClick"],He=E(()=>n("img",{src:ve,class:"open-info",alt:"info icon"},null,-1)),je=[He],qe={class:"modal-module"},Fe={class:"chars"},Be={class:"output"},$e=le({__name:"PlanetsCalc",setup(g){const{SP2ShipmentsBoostPct:B}=ge,R={CreditStorage:"CreditStorageModifier",FuelStorage:"FuelStorageModifier",CreditsPerHour:"CreditIncomeModifier",FuelPerHour:"FuelIncomeModifier",ShipmentsCRValuePerDay:"CreditShipmentModifier"},M={TotalShipmentCRPerDay:"ShipmentsCRValuePerDay",Cost:"Cost",ConstructionTime:"TimeToUpgrade"},$=["XPAward","Cost","TimeToUpgrade","TimeToUpgradeParallel","RSLevelReq"],K=["CrystalsWeight","Name"],Y=Object.keys(Z).filter(t=>![...$,...K].includes(t)),w=Object.values(F.NumMoons).reduce((t,a,i)=>(a&&(Array.isArray(a)?a.forEach((e,s)=>t[F.PlanetTypes[i][s]]=e):t[F.PlanetTypes[i]]=a),t),{}),U=se(),{t:J}=oe(),W=x([]),v=x({actually:{},plan:{}}),V=x(!1),T=ne({size:re.SMALL,title:"name",data:{planet:{},get key(){return this.planet.Name}}}),f=ie(()=>Object.values(W.value));let m;U.subscribe(t=>{t.type==H.SWITCH_PLANETS_CALC_SP2&&m&&(z(m),m.forceReCalc()),t.type==H.SET_CALC_DAY_CREDIT_LIMIT&&m.forceReCalc()});function z(t){m=t,W.value=t.provideGetterElements(ae)}function Q(t){T.title=J(t.TID),T.data.planet=t,V.value=!0}function G(t,a){return m.outputClasses(t,T.data.key,a)}function ee(t,a){f.value.forEach(async({Name:i})=>{i.startsWith("TradingStation")||m.onChangeLvl(t,i,parseInt(a))})}function te(t,a){let i=0;const e={};for(const s of Y)a.total.intermediate[s]={actually:0,plan:0,sum:0};return pe(()=>a.total.result.TimeToUpgrade,()=>{i=0}),function(s,o){var r,h;const u=U.state.userSettings.calcDayCreditLimit/24;let l=0;for(const c of Y)a.total.intermediate[c].actually+=((r=a.actually[s])==null?void 0:r[c])||0,a.total.intermediate[c].plan+=((h=a.plan[s])==null?void 0:h[c])||0,a.total.intermediate[c].sum=a.total.intermediate[c].actually+a.total.intermediate[c].plan;if(t[s].RSLevelReq){const c=t[s].RSLevelReq[o.plan[s]-1]||0;i=a.total.result.RSLevelReq=i<c?c:i}if(t[s].TimeToUpgrade){const c=t[s],I=o.actually[s],O=o.plan[s],_=[];for(let S=0;S<O-I;S++){const L=I+S,D=c.TimeToUpgrade[L]/3600;for(let y=0;y<D;y++)_.push(c.Cost[L]/(c.TimeToUpgrade[L]/3600))}_.length?e[s]=_:delete e[s],Object.keys(e).length&&(Ae(Object.values(e)).forEach(S=>{const L=S.reduce((D,y)=>D+y||0,0);l+=Math.ceil(L/u)}),a.total.result.TimeToUpgradeParallel=l*3600)}}}function ae(...[t,a,i]){let e=0;const s=k(Z,{filter:([,l])=>Array.isArray(l)}),o=k(Se,{...ye("planets.yellowstar"),map:([l,r])=>(i[l]=k(s,{map:([h,c])=>{const I=r.MaxUpgradeLevel,O=h=="ShipmentsCRValuePerDay"&&U.state.userSettings.planetsCalcSp2?B/100:0;let _=c.map(S=>S*(h in R?r[R[h]]/100:1));return h=="ShipmentsCRValuePerDay"&&(_=c.map(S=>{const L=r[R.ShipmentsCRValuePerDay]/100,D=r.Name in w?w[r.Name]:0,y=S*L*(D+1);return y+y*O})),_.length<I&&_.push(...Array.from({length:I-_.length},()=>_[_.length-1])),[h,_]}}),t[l]=r.TID,[l,r])}),u=k(Ce.TradingStation,{map:([l,r])=>(Array.isArray(r)&&r.length>e&&(e=r.length),[l in M?M[l]:l,r])});u.MaxUpgradeLevel=e;for(let l=0;u.MaxOnOwnSolarSystem>l;l++){const r={...u,Name:`${u.Name}_${l}`};o[r.Name]=r,i[r.Name]=a(r,e)}return o}return(t,a)=>{const i=ce("t");return d(),p("div",Pe,[n("div",Re,[N(Te,{input:v.value,"onUpdate:input":a[0]||(a[0]=e=>v.value=e),"stack-chars":$,"calc-total":te,"local-storage-key":"planetsCalc","title-key":"PLANETS_CALC",onSetup:z},null,8,["input"]),n("div",Ie,[n("div",null,[j(n("p",De,null,512),[[i,"TID_STARTER_PACK_2"]]),be]),n("input",{id:"compact-mode",class:"checkbox",type:"checkbox",checked:t.$store.state.userSettings.planetsCalcSp2,onChange:a[1]||(a[1]=e=>t.$store.commit(A(H).SWITCH_PLANETS_CALC_SP2))},null,40,Ee),Me]),N(he,{data:{TID:"INPUT_VALUES",Name:"Input",TID2:["",...f.value.map(e=>e.TID)]},"table-opts":{lvlColKey:"â„–",mergeCells:!1,colLvlStartAt:0}},{"table-head":q(()=>[j(n("th",null,null,512),[[i,"CURRENT_LVL"]]),j(n("th",null,null,512),[[i,"PLAN_LVL"]]),Ne]),"table-body":q(({row:e})=>[e==0?(d(),p(C,{key:0},[(d(!0),p(C,null,P(v.value,(s,o)=>(d(),p("td",{key:o},[n("select",{class:"select",onChange:u=>ee(o,u.target.value)},[(d(!0),p(C,null,P(f.value[e].MaxUpgradeLevel+1,(u,l)=>(d(),p("option",{key:o+u,selected:A(m).isSelected(o,f.value[e].Name,l)},b(l),9,Ue))),128))],40,ke)]))),128)),Ve],64)):(d(),p(C,{key:1},[(d(!0),p(C,null,P(v.value,(s,o)=>{var u,l;return d(),p("td",{key:o},[n("div",Oe,[N(Le,{value:((u=v.value[o])==null?void 0:u[f.value[e-1].Name])||0,min:(o=="plan"?(l=v.value.actually)==null?void 0:l[f.value[e-1].Name]:0)||0,max:f.value[e-1].MaxUpgradeLevel,"onUpdate:value":r=>A(m).onChangeLvl(o,f.value[e-1].Name,r)},null,8,["value","min","max","onUpdate:value"])])])}),128)),n("td",null,[n("div",{onClick:()=>Q(f.value[e-1])},je,8,xe)])],64))]),_:1},8,["data"])]),N(de,ue({open:V.value,"onUpdate:open":a[2]||(a[2]=e=>V.value=e)},T),{body:q(()=>[n("div",qe,[n("ul",Fe,[n("li",Be,[n("b",null,b(t.$t("TID_PLANET_LEVEL_DESCR")),1),n("div",null,[(d(!0),p(C,null,P(v.value,(e,s)=>{var o;return d(),p("span",{key:s,class:X(G(s,null))},b((o=v.value[s])==null?void 0:o[T.data.key]),3)}),128))])]),(d(!0),p(C,null,P(Object.keys(A(m).output.plan[T.data.key]||{}).filter(e=>!K.includes(e)),e=>(d(),p("li",{key:e,class:"calc.output"},[n("b",null,b(A(m).format.key(e)),1),n("div",null,[(d(!0),p(C,null,P(v.value,(s,o)=>{var u,l;return d(),p("span",{key:o,class:X(G(o,e))},b(A(m).format.value(e,Math.trunc((l=(u=A(m).output[o])==null?void 0:u[T.data.key])==null?void 0:l[e])||void 0)),3)}),128))])]))),128))])])]),_:1},16,["open"])])}}}),tt=fe($e,[["__scopeId","data-v-27729408"]]);export{tt as default};
